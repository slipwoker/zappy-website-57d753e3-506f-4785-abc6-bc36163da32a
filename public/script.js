document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(e){const t=e.target.closest('a[href^="#"]');if(t&&"#"!==t.getAttribute("href")){e.preventDefault();const o=t.getAttribute("href"),n=document.querySelector(o);n&&n.scrollIntoView({behavior:"smooth",block:"start"})}});const e=document.querySelector("nav, .navbar, header");if(e){function t(){window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")}window.addEventListener("scroll",t),t()}const o=document.querySelector(".contact-form");o&&o.addEventListener("submit",function(e){e.preventDefault();let t=!0;o.querySelectorAll("input, textarea, select").forEach(function(e){const o=e.parentElement.querySelector(".error-message");if(o&&o.remove(),e.classList.remove("error"),e.hasAttribute("required")&&!e.value.trim()){t=!1,e.classList.add("error");const o=document.createElement("span");o.className="error-message",o.textContent="This field is required",o.style.color="red",o.style.fontSize="0.875rem",o.style.marginTop="0.25rem",o.style.display="block",e.parentElement.appendChild(o)}if("email"===e.type&&e.value.trim()){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim())){t=!1,e.classList.add("error");const o=document.createElement("span");o.className="error-message",o.textContent="Please enter a valid email address",o.style.color="red",o.style.fontSize="0.875rem",o.style.marginTop="0.25rem",o.style.display="block",e.parentElement.appendChild(o)}}}),t&&o.submit()});const n=document.querySelectorAll('.fade-in, [data-animate="fade-in"]');if(n.length>0){const a=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&(e.target.classList.add("animated"),a.unobserve(e.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});n.forEach(function(e){e.style.transform="translateY(20px)",e.style.transition="opacity 0.6s ease, transform 0.6s ease",a.observe(e)});const r=document.createElement("style");r.textContent='.fade-in.animated, [data-animate="fade-in"].animated { opacity: 1 !important; transform: translateY(0) !important; }',document.head.appendChild(r)}}),function(){const e=window.ZAPPY_WEBSITE_ID;function t(){const e=document.querySelector(".zappy-announcement-bar"),t=document.querySelector(".zappy-catalog-menu"),o=e?Math.ceil(e.getBoundingClientRect().height):0,n=function(){const e=["header","nav#navbar","nav.navbar",'nav[class*="nav"]',".navbar"];for(const t of e){const e=document.querySelector(t);if(e&&!(e.classList&&e.classList.contains("zappy-catalog-menu")||"zappy-catalog-menu"===e.id||e.classList&&e.classList.contains("mobile-search-panel")))return e}return null}();if(n){n.style.marginBottom="0",n.style.setProperty("top",o+"px","important");const e=Math.ceil(n.getBoundingClientRect().height||n.offsetHeight||0);let a=o+e;if(t){t.style.marginTop="0";const n=o+e;t.style.setProperty("top",n+"px","important");a=n+Math.ceil(t.getBoundingClientRect().height||t.offsetHeight||0)}document.documentElement.style.setProperty("--header-height",e+"px"),document.documentElement.style.setProperty("--total-header-height",a+"px"),document.body.style.setProperty("padding-top",a+"px","important")}else o>0&&document.body.style.setProperty("padding-top",o+"px","important")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),window.addEventListener("resize",t),setTimeout(t,50),setTimeout(t,200),setTimeout(t,500);const o=function(e){"/"!==e.charAt(0)&&(e="/"+e);const t=function(){const e=(window.ZAPPY_API_BASE||"").replace(/\/$/,""),t=window.location?window.location.pathname:"";return-1!==t.indexOf("/preview")||-1!==t.indexOf("/preview-fullscreen")?window.location.origin:e}();return t?t+e:e};if(!e)return;const n={products:"Products",ourProducts:"Our Products",featuredProducts:"Featured Products",noFeaturedProducts:"No featured products yet. Check out all our products!",featuredCategories:"Shop by Category",all:"All",featured:"Featured",new:"New",sale:"Sale",loadingProducts:"Loading products...",cart:"Cart",yourCart:"Your Cart",emptyCart:"Cart is empty",total:"Total",proceedToCheckout:"Proceed to Checkout",checkout:"Checkout",customerInfo:"Customer Info",fullName:"Full Name",email:"Email",phone:"Phone",shippingAddress:"Shipping Address",street:"Street Address",apartment:"Apt, Floor, Unit",city:"City",zip:"ZIP Code",shippingMethod:"Shipping Method",loadingShipping:"Loading shipping methods...",payment:"Payment",loadingPayment:"Loading payment options...",orderSummary:"Order Summary",subtotal:"Subtotal",vat:"VAT",vatIncluded:"VAT Included",shipping:"Shipping",discount:"Discount",totalToPay:"Total",placeOrder:"Place Order",login:"Login",customerLogin:"Customer Login",enterEmail:"Enter your email and we'll send you a login code",emailAddress:"Email Address",sendCode:"Send Code",enterCode:"Enter the code sent to your email",verificationCode:"Verification Code",verify:"Verify",returnPolicy:"Return Policy",addToCart:"Add to Cart",addedToCart:"Product added to cart!",remove:"Remove",noProducts:"No products to display",errorLoading:"Error loading",days:"days",currency:"$",free:"FREE",freeAbove:"Free above",noShippingMethods:"No shipping options available",viewAllResults:"View all results",searchProducts:"Search products",productDetails:"Product Details",viewDetails:"View Details",inStock:"In Stock",outOfStock:"Out of Stock",sku:"SKU",category:"Category",relatedProducts:"Related Products",productNotFound:"Product not found",backToProducts:"Back to Products",home:"Home",quantity:"Quantity",couponCode:"Coupon Code",enterCouponCode:"Enter coupon code",applyCoupon:"Apply",removeCoupon:"Remove",couponApplied:"Coupon applied successfully!",invalidCoupon:"Invalid coupon code",couponExpired:"Coupon has expired",couponMinOrder:"Minimum order amount",alreadyHaveAccount:"Already have an account?",loginHere:"Login here",loggedInAs:"Logged in as:",logout:"Logout",haveCouponCode:"I have a coupon code",orderSuccess:"Order Received!",thankYouOrder:"Thank you for your order",orderNumber:"Order Number",orderConfirmation:"A confirmation email has been sent to you",orderProcessing:"Your order is being processed. We'll notify you when it ships.",continueShopping:"Continue Shopping",orderDetails:"Order Details",loadingOrder:"Loading order details...",orderNotFound:"Order not found",orderItems:"Order Items",paidAmount:"Amount Paid",myAccount:"My Account",accountWelcome:"Welcome",yourOrders:"Your Orders",noOrders:"No orders yet",orderDate:"Date",orderStatus:"Status",orderTotal:"Total",viewOrder:"View Order",statusPending:"Pending Payment",statusPaid:"Paid",statusProcessing:"Processing",statusShipped:"Shipped",statusDelivered:"Delivered",statusCancelled:"Cancelled",notLoggedIn:"Not Logged In",pleaseLogin:"Please login to view your account",personalDetails:"Personal Details",editProfile:"Edit Profile",name:"Name",saveChanges:"Save Changes",cancel:"Cancel",addresses:"Addresses",addAddress:"Add Address",editAddress:"Edit Address",deleteAddress:"Delete Address",setAsDefault:"Set as Default",defaultAddress:"Default Address",addressLabel:"Address Label",work:"Work",other:"Other",noAddresses:"No saved addresses",confirmDelete:"Are you sure you want to delete?",profileUpdated:"Profile updated successfully",addressSaved:"Address saved successfully",addressDeleted:"Address deleted",saving:"Saving...",selectVariant:"Select option",variantUnavailable:"Unavailable",color:"Color",size:"Size",material:"Material",style:"Style",weight:"Weight",capacity:"Capacity",length:"Length",inquiryAbout:"Inquiry about",sendInquiry:"Send Inquiry",callNow:"Call Now",specifications:"Specifications",businessPhone:"[business_phone]",businessEmail:"[business_email]"};const a=document.documentElement.lang||"",r=["he","ar","iw"].includes(a.toLowerCase().substring(0,2))||"rtl"===document.documentElement.dir||"rtl"===document.body.dir;let i=JSON.parse(localStorage.getItem("zappy_cart_"+e)||"[]"),s=.18,d="standard",c=!1;async function l(){if(!c)try{const t=await fetch(o("/api/ecommerce/storefront/settings?websiteId="+e)),n=await t.json();n.success&&n.data&&(n.data.taxRate&&n.data.taxRate>0&&(s=n.data.taxRate),n.data.productLayout&&(d=n.data.productLayout),c=!0)}catch(e){console.warn("Failed to fetch store settings, using defaults:",e)}}function u(e){return(e||"").replace(/[â€â€â€ª-â€®â¦-â©â€‹-â€ï»¿]/g,"").trim()}function p(){localStorage.setItem("zappy_cart_"+e,JSON.stringify(i)),m(),C()}function m(){const e=i.reduce((e,t)=>e+t.quantity,0);document.querySelectorAll(".cart-count").forEach(function(t){t.textContent=e})}function g(e){return e.sale_price&&parseFloat(e.sale_price)<parseFloat(e.price)?parseFloat(e.sale_price):parseFloat(e.price)}function y(e){const t=e.selectedVariant?e.selectedVariant.id:null,o=t?e.id+"-"+t:e.id,n=i.find(e=>{const t=e.selectedVariant?e.selectedVariant.id:null;return(t?e.id+"-"+t:e.id)===o});n?n.quantity++:i.push({...e,quantity:1}),p(),E()}l();var f=[],h="all";async function v(){if(!document.getElementById("zappy-product-grid"))return;await l();const t=new URLSearchParams(window.location.search),o=t.get("page");let n=t.get("category");if(o){const e=new URL(o,window.location.origin);n=e.searchParams.get("category")||n}if(n)try{const t=await fetch(buildApiUrlWithLang("/api/ecommerce/storefront/categories?websiteId="+e)),o=await t.json();if(o.success&&o.data){const e=o.data.find(function(e){return e.id===n});if(e){const t=document.querySelector(".products-section"),o=t?t.querySelector("h1"):null;o&&(o.textContent=e.name),document.title=e.name+" - "+document.title.split(" - ").pop()}}}catch(e){console.warn("Failed to fetch category name",e)}w("all")}async function w(t){const o=document.getElementById("zappy-product-grid");if(o){h=t||"all",document.querySelectorAll(".filter-btn").forEach(function(e){e.classList.remove("active"),e.getAttribute("data-category")===h&&e.classList.add("active")});try{const t=new URLSearchParams(window.location.search),r=t.get("page");let i=t.get("category");if(r){i=new URL(r,window.location.origin).searchParams.get("category")||i}let s=buildApiUrlWithLang("/api/ecommerce/storefront/products?websiteId="+e);i&&(s+="&categoryId="+i);const c=await fetch(s),l=await c.json();if(!l.success||!l.data?.length)return o.innerHTML='<div class="empty-cart">'+n.noProducts+"</div>",void(f=[]);var a=f=l.data;if("featured"===h?a=f.filter(function(e){return e.is_featured}):"sale"===h?a=f.filter(function(e){return e.sale_price&&parseFloat(e.sale_price)<parseFloat(e.price)}):"new"===h&&(a=f.filter(function(e){return e.tags&&e.tags.some(function(e){return"new"===e.toLowerCase()||"×—×“×©"===e.toLowerCase()})})),0===a.length)return void(o.innerHTML='<div class="empty-cart">'+n.noProducts+"</div>");!function(e,t){e.className="product-grid layout-"+d,e.innerHTML=t.map(function(e){var t=!1!==e.custom_fields?.showPrice,o=e.sale_price&&parseFloat(e.sale_price)<parseFloat(e.price),a=t?o?n.currency+parseFloat(e.sale_price).toFixed(2)+'<span class="original-price">'+n.currency+parseFloat(e.price).toFixed(2)+"</span>":n.currency+parseFloat(e.price).toFixed(2):"",r=e.images&&e.images[0]?b(e.images[0]):"",i=[];e.tags&&e.tags.length&&e.tags.forEach(function(e){var t=e.toLowerCase();"sale"===t||"××‘×¦×¢"===t?i.push('<span class="product-tag tag-sale">'+e+"</span>"):"new"===t||"×—×“×©"===t?i.push('<span class="product-tag tag-new">'+e+"</span>"):"featured"===t||"××•××œ×¥"===t?i.push('<span class="product-tag tag-featured">'+e+"</span>"):i.push('<span class="product-tag">'+e+"</span>")});var s=i.length>0?'<div class="product-tags">'+i.join("")+"</div>":"",c="",l=r?'<img src="'+r+'" alt="'+e.name+'">':'<div class="no-image-placeholder">ğŸ“¦</div>',u=function(e,t){if("undefined"!=typeof zappyI18n&&"function"==typeof zappyI18n.t){var o=zappyI18n.t("ecom_"+e);if(o&&o!=="ecom_"+e)return o}return t}("addToCart",n.addToCart),p=t?'<div class="price">'+a+"</div>":"";return c="compact"===d?s+'<a href="/product/'+(e.slug||e.id)+'" class="product-card-link">'+l+"<h3>"+e.name+"</h3>"+p+"</a>":"detailed"===d?s+'<a href="/product/'+(e.slug||e.id)+'" class="product-card-link">'+l+"<h3>"+e.name+"</h3><p>"+(e.description||"").substring(0,150)+(e.description?.length>150?"...":"")+"</p>"+p+'</a><button class="add-to-cart" onclick="event.stopPropagation(); window.zappyHandleAddToCart('+JSON.stringify(e).replace(/"/g,"&quot;")+')">'+u+"</button>":s+'<a href="/product/'+(e.slug||e.id)+'" class="product-card-link">'+l+"<h3>"+e.name+"</h3><p>"+(e.description||"").substring(0,80)+(e.description?.length>80?"...":"")+"</p>"+p+"</a>",'<div class="product-card '+d+'" data-product-id="'+e.id+'">'+c+"</div>"}).join("")}(o,a)}catch(e){console.error("Failed to load products",e),o.innerHTML='<div class="empty-cart">'+n.errorLoading+"</div>"}}}function b(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:"))return e;if(e.startsWith("/api/website/preview"))return e;if(e.startsWith("/preview-fullscreen/"))return"/api/website"+e;if(e.startsWith("/preview/"))return"/api/website"+e;var t=function(){var e=window.ZAPPY_WEBSITE_ID||window.ZAPPY_CONFIG&&window.ZAPPY_CONFIG.websiteId,t=window.location&&window.location.pathname?window.location.pathname:"";return e&&t?-1!==t.indexOf("/api/website/preview-fullscreen/")?"/api/website/preview-fullscreen/"+e+"/assets/":-1!==t.indexOf("/api/website/preview/")?"/api/website/preview/"+e+"/assets/":-1!==t.indexOf("/preview-fullscreen/")?"/api/website/preview-fullscreen/"+e+"/assets/":-1!==t.indexOf("/preview/")?"/api/website/preview/"+e+"/assets/":"":""}(),o=e.replace(/^\/?assets\//,"");return t?t+o:e.startsWith("/")?e:"/"+e}function C(){const e=document.getElementById("cart-drawer-items"),t=document.getElementById("cart-drawer-total");if(!e)return;if(0===i.length)return e.innerHTML='<div class="empty-cart"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg><p>'+n.emptyCart+"</p></div>",void(t&&(t.textContent=n.currency+"0"));let o=0;e.innerHTML=i.map(e=>{const t=g(e);o+=t*e.quantity;const a=e.variantName?'<div class="cart-item-variant">'+e.variantName+"</div>":"";return'<div class="cart-item" data-item-id="'+e.id+(e.selectedVariant?"-"+e.selectedVariant.id:"")+'"><img src="'+(b(e.images?.[0])||"data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2270%22 height=%2270%22 viewBox=%220 0 70 70%22%3E%3Crect fill=%22%23f3f4f6%22 width=%2270%22 height=%2270%22/%3E%3Cpath fill=%22%239ca3af%22 d=%22M28 25h14v14H28z%22/%3E%3C/svg%3E")+'" alt="'+e.name+'"><div class="cart-item-info"><div class="cart-item-name">'+e.name+"</div>"+a+'<div class="cart-item-price">'+n.currency+(t*e.quantity).toFixed(2)+'</div><div class="cart-item-qty"><button onclick="window.zappyUpdateQty(\''+e.id+(e.selectedVariant?"-"+e.selectedVariant.id:"")+"', -1)\">âˆ’</button><span>"+e.quantity+"</span><button onclick=\"window.zappyUpdateQty('"+e.id+(e.selectedVariant?"-"+e.selectedVariant.id:"")+'\', 1)">+</button></div></div><button class="cart-item-remove" onclick="window.zappyRemoveFromCart(\''+e.id+(e.selectedVariant?"-"+e.selectedVariant.id:"")+'\')"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg></button></div>'}).join(""),t&&(t.textContent=n.currency+o.toFixed(2))}function E(){var e=document.getElementById("cart-drawer"),t=document.getElementById("cart-drawer-overlay");if(!e){var o='<div class="cart-drawer-overlay" id="cart-drawer-overlay"></div><aside class="cart-drawer" id="cart-drawer"><div class="cart-drawer-header"><h2>'+n.yourCart+'</h2><button type="button" class="cart-drawer-close" id="cart-drawer-close"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div><div class="cart-drawer-body" id="cart-drawer-items"><div class="empty-cart">'+n.emptyCart+'</div></div><div class="cart-drawer-footer"><div class="cart-drawer-total"><span>'+n.total+':</span><span id="cart-drawer-total">'+n.currency+'0</span></div><a href="/checkout" class="cart-drawer-checkout">'+n.proceedToCheckout+"</a></div></aside>";document.body.insertAdjacentHTML("beforeend",o),e=document.getElementById("cart-drawer"),t=document.getElementById("cart-drawer-overlay");var a=document.getElementById("cart-drawer-close");a&&a.addEventListener("click",L),t&&t.addEventListener("click",L)}e&&(e.classList.add("active"),document.body.style.overflow="hidden"),t&&t.classList.add("active"),C()}function L(){var e=document.getElementById("cart-drawer"),t=document.getElementById("cart-drawer-overlay");e&&e.classList.remove("active"),t&&t.classList.remove("active"),document.body.style.overflow=""}function S(){const e=document.getElementById("cart-items"),t=document.getElementById("cart-total");if(!e)return;if(0===i.length)return e.innerHTML='<div class="empty-cart">'+n.emptyCart+"</div>",void(t&&(t.textContent=n.currency+"0"));let o=0;e.innerHTML=i.map(e=>{const t=g(e);o+=t*e.quantity;const a=e.variantName?'<br><span style="font-size:12px;color:#6b7280;">'+e.variantName+"</span>":"",r=e.selectedVariant?e.id+"-"+e.selectedVariant.id:e.id;return'<div class="cart-item"><img src="'+(b(e.images?.[0])||"")+'" alt="'+e.name+'"><div><strong>'+e.name+"</strong>"+a+"<br>"+n.currency+t.toFixed(2)+" x "+e.quantity+"</div><button onclick=\"window.zappyRemoveFromCart('"+r+"')\">"+n.remove+"</button></div>"}).join(""),t&&(t.textContent=n.currency+o.toFixed(2))}window.resolveProductImageUrl=b,window.zappyUpdateQty=function(e,t){const o=i.find(t=>{const o=t.selectedVariant?t.selectedVariant.id:null;return(o?t.id+"-"+o:t.id)===e});o&&(o.quantity+=t,o.quantity<=0&&(i=i.filter(t=>{const o=t.selectedVariant?t.selectedVariant.id:null;return(o?t.id+"-"+o:t.id)!==e})),p(),C())};let I=null,P=[];let k=null,A=[],x=!1;function B(){const t=document.getElementById("place-order-btn");t&&(t.addEventListener("click",async function(a){if(a.preventDefault(),!i||0===i.length)return void alert(r?"×”×¢×’×œ×” ×¨×™×§×”":"Cart is empty");if(!I)return void alert(r?"× × ×œ×‘×—×•×¨ ×©×™×˜×ª ××©×œ×•×—":"Please select a shipping method");if(!x||!k)return void alert(r?"×ª×©×œ×•× ××§×•×•×Ÿ ×œ× ××•×’×“×¨. ×¦×¨×• ×§×©×¨ ×¢× ×‘×¢×œ ×”××ª×¨.":"Online payment not configured. Please contact the store owner.");const s=document.getElementById("customer-name")?.value?.trim()||"",d=u(document.getElementById("customer-email")?.value||""),c=document.getElementById("customer-phone")?.value?.trim()||"";if(!s||!d)return void alert(r?"× × ×œ××œ× ×©× ×•××™××™×™×œ":"Please fill in name and email");const l=document.getElementById("shipping-street")?.value?.trim()||"",p=document.getElementById("shipping-apartment")?.value?.trim()||"",m=document.getElementById("shipping-city")?.value?.trim()||"",g=document.getElementById("shipping-zip")?.value?.trim()||"";if(I.is_pickup||l&&m){t.disabled=!0,t.innerHTML=r?"××¢×‘×“...":"Processing...";try{let t=localStorage.getItem("zappy_session_id");t||(t="sess_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),localStorage.setItem("zappy_session_id",t));const n=await fetch(o("/api/ecommerce/checkout/init"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteId:e,sessionId:t,customerEmail:d,customerName:s,customerPhone:c,shippingAddress:{street:l,apartment:p,city:m,zip:g},shippingMethodId:I.id,shippingCost:I.price||0,shippingMethodName:I.name||"××©×œ×•×—",cart:i,couponCode:T?T.code:null,couponDiscount:_})}),a=await n.json();if(!a.success||!a.data?.checkoutUrl)throw new Error(a.error||"Checkout initialization failed");const u=a.data.reference;if(u){const e=F(),t=parseFloat(I.price)||0,o=parseFloat(_)||0,n={cartItems:i,subtotal:e,shippingCost:t,discount:o,total:e+t-o,shippingMethodName:I.name||"",customerName:s,customerEmail:d};localStorage.setItem("zappy_pending_order_"+u,JSON.stringify(n))}if("greeninvoice"===a.data.provider){const e=document.getElementById("checkout-payment-section"),t=document.getElementById("greeninvoice-iframe-container"),o=document.getElementById("greeninvoice-iframe");if(e&&t&&o)return e.classList.add("fade-out"),t.style.display="block",t.querySelector(".greeninvoice-iframe-wrapper").innerHTML='<div class="greeninvoice-loading"><div class="greeninvoice-loading-spinner"></div><span>'+(r?"×˜×•×¢×Ÿ ×¢××•×“ ×ª×©×œ×•×...":"Loading payment page...")+"</span></div>",window.addEventListener("message",function(e){e.data&&"zappy_order_success"===e.data.type&&e.data.url&&(window.location.href=e.data.url)}),void setTimeout(function(){e.style.display="none",t.querySelector(".greeninvoice-iframe-wrapper").innerHTML='<iframe id="greeninvoice-iframe" src="'+a.data.checkoutUrl+'" frameborder="0" allowpaymentrequest="true" style="width: 100%; height: 600px; border: none;"></iframe>'},300)}window.location.href=a.data.checkoutUrl}catch(e){console.error("Checkout failed:",e),alert(r?"×©×’×™××” ×‘×ª×”×œ×™×š ×”×ª×©×œ×•×. × ×¡×• ×©×•×‘.":"Checkout failed. Please try again."),t.disabled=!1,t.innerHTML=n.placeOrder||(r?"×‘×¦×¢ ×”×–×× ×”":"Place Order")}}else alert(r?"× × ×œ××œ× ×›×ª×•×‘×ª ×œ××©×œ×•×—":"Please fill in shipping address")}),function(){const e=document.getElementById("customer-name"),t=document.getElementById("customer-email"),n=document.getElementById("customer-phone");if(!e||!t)return;const a=localStorage.getItem("zappy_customer_token"),r=localStorage.getItem("zappy_customer_email"),i=document.getElementById("checkout-login-prompt"),s=document.getElementById("checkout-login-link"),d=document.getElementById("checkout-logged-in"),c=document.getElementById("checkout-logged-in-name"),l=document.getElementById("checkout-logged-in-email"),u=document.getElementById("checkout-logout-btn");s&&s.addEventListener("click",function(){sessionStorage.setItem("zappy_login_return","/checkout")});const p=(e,t)=>{i&&(i.style.display="none"),d&&(d.style.display="flex"),c&&(c.textContent=e||""),l&&(l.textContent=t?"("+t+")":"")},m=()=>{d&&(d.style.display="none"),i&&(i.style.display="flex"),c&&(c.textContent=""),l&&(l.textContent="")};r&&!t.value&&(t.value=r);if(!a)return void m();fetch(o("/api/ecommerce/customers/me"),{headers:{Authorization:"Bearer "+a}}).then(function(e){if(!e.ok)throw new Error("Unauthorized");return e.json()}).then(function(o){if(!o.success||!o.data)throw new Error("Invalid response");const a=o.data,i=a.name||a.email||r||"";p(i,a.email||r||""),a.name&&!e.value&&(e.value=a.name),a.email&&!t.value&&(t.value=a.email),a.phone&&n&&!n.value&&(n.value=a.phone)}).catch(function(){localStorage.removeItem("zappy_customer_token"),localStorage.removeItem("zappy_customer_email"),m()}),u&&u.addEventListener("click",function(){localStorage.removeItem("zappy_customer_token"),localStorage.removeItem("zappy_customer_email"),m()})}())}window.zappySelectPayment=function(e){k=A.find(t=>t.id===e),document.querySelectorAll(".payment-option").forEach(t=>{t.classList.toggle("selected",t.dataset.methodId===e)})};let T=null,_=0;function F(){return i.reduce((e,t)=>e+g(t)*t.quantity,0)}function z(){const e=document.getElementById("subtotal"),t=document.getElementById("vat-amount"),o=document.getElementById("shipping-cost"),a=document.getElementById("discount"),r=document.getElementById("discount-row"),d=document.getElementById("order-total"),c=document.getElementById("order-items"),l=F();let u=function(){if(!I)return 0;const e=F();return I.conditions?.freeAbove&&e>=I.conditions.freeAbove?0:parseFloat(I.price)||0}();T&&("percentage"===T.type?_=l*T.value/100:"fixed"===T.type?_=T.value:"free_shipping"===T.type&&(_=0,u=0),_>l&&(_=l));const p=l+u-_,m=p*s/(1+s);e&&(e.textContent=n.currency+l.toFixed(2)),t&&(t.textContent=n.currency+m.toFixed(2)),o&&(o.textContent=0===u?n.free||"FREE":n.currency+u.toFixed(2)),r&&a&&(_>0?(r.style.display="block",a.textContent="-"+n.currency+_.toFixed(2)):r.style.display="none"),d&&(d.textContent=n.currency+p.toFixed(2)),c&&(c.innerHTML=i.map(e=>{const t=g(e),o=e.variantName?" ("+e.variantName+")":"";return'<div class="order-item"><span>'+e.name+o+" x "+e.quantity+"</span><span>"+n.currency+(t*e.quantity).toFixed(2)+"</span></div>"}).join(""))}window.zappySelectShipping=function(e){I=P.find(t=>t.id===e),document.querySelectorAll(".shipping-option").forEach(t=>{t.classList.toggle("selected",t.dataset.methodId===e)});const t=document.getElementById("shipping-address-section");t&&(I&&I.is_pickup?t.style.display="none":t.style.display="block"),z()},window.zappyAddToCart=y,window.zappyHandleAddToCart=function(t){if(parseInt(t.variant_count||0)>0){const o="/product/"+(t.slug||t.id),n=window.location.href;if(n.includes("/api/website/preview")){const t=n.includes("preview-fullscreen")?"preview-fullscreen":"preview";window.location.href="/api/website/"+t+"/"+e+"?page="+encodeURIComponent(o)}else window.location.href=o}else y(t)},window.zappyRemoveFromCart=function(e){i=i.filter(t=>{const o=t.selectedVariant?t.selectedVariant.id:null;return(o?t.id+"-"+o:t.id)!==e}),p(),S(),C()};let M=[],O=null;async function N(){try{const t=await fetch(buildApiUrlWithLang("/api/ecommerce/storefront/products?websiteId="+e)),o=await t.json();o.success&&o.data&&(M=o.data)}catch(e){console.error("Failed to load products for search",e)}}function D(e){if(!e||e.length<2)return[];const t=e.toLowerCase();return M.filter(e=>e.name?.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.sku?.toLowerCase().includes(t)||e.tags?.some(e=>e.toLowerCase().includes(t))).slice(0,6)}function q(){const e=document.getElementById("nav-search-input"),t=document.getElementById("nav-search-btn"),o=document.getElementById("nav-search-results");if(e&&(N(),e.addEventListener("input",function(){const e=this.value.trim();clearTimeout(O),e.length<2?o&&o.classList.remove("active"):O=setTimeout(function(){!function(e,t){const o=document.getElementById("nav-search-results");if(!o)return;if(0===e.length)return o.innerHTML='<div class="search-no-results">'+(n.noProducts||"No products found")+"</div>",void o.classList.add("active");var a=window.location.pathname.includes("preview-fullscreen");let r=e.map(function(e){var t;if(a){var o=new URL(window.location.href);o.searchParams.set("page","/product/"+(e.slug||e.id)),o.searchParams.delete("search"),t=o.toString()}else t="/product/"+(e.slug||e.id);return'<a href="'+t+'" class="search-result-item">'+(e.images?.[0]?'<img src="'+b(e.images[0])+'" alt="'+e.name+'" class="search-result-img">':'<div class="search-result-img"></div>')+'<div class="search-result-info"><div class="search-result-name">'+e.name+'</div><div class="search-result-price">'+n.currency+e.price+"</div></div></a>"}).join("");if(M.filter(e=>e.name?.toLowerCase().includes(t.toLowerCase())).length>6){var i;if(window.location.pathname.includes("preview-fullscreen")){var s=new URL(window.location.href);s.searchParams.set("page","/products"),s.searchParams.set("search",t),i=s.toString()}else i="/products?search="+encodeURIComponent(t);r+='<a href="'+i+'" class="search-view-all">'+(n.viewAllResults||"View all results")+" â†’</a>"}o.innerHTML=r,o.classList.add("active")}(D(e),e)},200)}),t&&t.addEventListener("click",function(){const t=e.value.trim();if(t.length>=2){if(window.location.pathname.includes("preview-fullscreen")){const e=new URL(window.location.href);e.searchParams.set("page","/products"),e.searchParams.set("search",t),window.location.href=e.toString()}else window.location.href="/products?search="+encodeURIComponent(t)}}),e.addEventListener("keypress",function(e){if("Enter"===e.key){const e=this.value.trim();if(e.length>=2){if(window.location.pathname.includes("preview-fullscreen")){const t=new URL(window.location.href);t.searchParams.set("page","/products"),t.searchParams.set("search",e),window.location.href=t.toString()}else window.location.href="/products?search="+encodeURIComponent(e)}}}),document.addEventListener("click",function(e){o&&!e.target.closest(".nav-search-box")&&o.classList.remove("active")}),"/products"===window.location.pathname)){const t=new URLSearchParams(window.location.search).get("search");t&&(e.value=t,function(e){const t=document.getElementById("zappy-product-grid");if(!t)return;setTimeout(function(){const o=t.querySelectorAll(".product-card"),a=e.toLowerCase();let r=0;if(o.forEach(function(e){const t=e.querySelector("h3")?.textContent?.toLowerCase()||"",o=e.querySelector("p")?.textContent?.toLowerCase()||"",n=t.includes(a)||o.includes(a);e.style.display=n?"":"none",n&&r++}),0===r){const e=document.createElement("div");e.className="empty-cart",e.textContent=n.noProducts||"No products found",e.id="search-no-results",t.appendChild(e)}},500)}(t))}}function U(){const e=[".nav-menu",".mobile-menu",".mobile-nav",'[class*="mobile-menu"]','[class*="nav-menu"]',".menu-items",".nav-links","nav ul"],t=[".hamburger",".menu-toggle",".nav-toggle",".mobile-toggle",'[class*="hamburger"]','[class*="menu-toggle"]',".menu-btn",'button[aria-label*="menu"]',".mobile-menu-btn"];let o=null,n=null;for(const t of e)if(o=document.querySelector(t),o)break;for(const e of t)if(n=document.querySelector(e),n)break;function a(){return!!o&&(o.classList.contains("active")||o.classList.contains("open")||o.classList.contains("show")||o.classList.contains("visible")||o.classList.contains("is-open"))}function r(){if(!o)return;o.classList.remove("active","open","show","visible","is-open","menu-open"),document.body.classList.remove("menu-open","nav-open","mobile-menu-open");const e=o.closest("nav")||o.closest("header");e&&e.classList.remove("active","open","show","menu-open","is-open"),n&&(n.classList.remove("active","open","is-active"),n.setAttribute("aria-expanded","false"));const t=document.querySelector(".mobile-menu-overlay");t&&t.remove()}let i=a();setInterval(function(){const e=a();if(e!==i)if(i=e,e){if(!document.querySelector(".mobile-menu-overlay")){const e=document.createElement("div");e.className="mobile-menu-overlay",e.style.cssText="position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:998;",e.addEventListener("click",function(){n?n.click():r()}),document.body.appendChild(e)}}else{const e=document.querySelector(".mobile-menu-overlay");e&&e.remove()}},100),document.querySelectorAll("nav a, .nav-menu a, .mobile-menu a").forEach(function(e){e.addEventListener("click",function(){setTimeout(r,100)})}),document.querySelectorAll(".nav-ecommerce-icons a, .cart-link, .login-link").forEach(function(e){e.addEventListener("click",function(){r()})}),document.addEventListener("click",function(e){if(o&&n&&a()){const t=o.contains(e.target),a=n.contains(e.target);t||a||r()}}),document.addEventListener("keydown",function(e){"Escape"===e.key&&r()}),window.zappyCloseMobileMenu=r}function R(){const e=document.getElementById("mobile-search-toggle"),t=document.getElementById("mobile-search-panel"),o=document.getElementById("close-mobile-search"),a=document.getElementById("mobile-search-input"),r=document.getElementById("mobile-search-results");if(e&&t){if(e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("active"),setTimeout(function(){a&&a.focus()},100)}),o&&o.addEventListener("click",function(){t.classList.remove("active"),a&&(a.value=""),r&&(r.innerHTML="")}),a){a.addEventListener("input",function(){const e=this.value.trim();clearTimeout(O),e.length<2?r&&(r.innerHTML=""):O=setTimeout(function(){!function(e,t){const o=document.getElementById("mobile-search-results");if(!o)return;if(0===e.length)return void(o.innerHTML='<div class="search-no-results">'+(n.noProducts||"No products found")+"</div>");var a=window.location.pathname.includes("preview-fullscreen");let r=e.slice(0,8).map(function(e){const t=formatPrice(e.price),o=e.images&&e.images[0]?b(e.images[0]):"";var n;if(a){var r=new URL(window.location.href);r.searchParams.set("page","/product/"+e.slug),r.searchParams.delete("search"),n=r.toString()}else n="/product/"+e.slug;return'<a href="'+n+'" class="search-result-item">'+(o?'<img src="'+o+'" alt="'+e.name+'" class="search-result-img">':"")+'<div class="search-result-info"><div class="search-result-name">'+e.name+'</div><div class="search-result-price">'+t+"</div></div></a>"}).join("");if(e.length>8){var i;if(window.location.pathname.includes("preview-fullscreen")){var s=new URL(window.location.href);s.searchParams.set("page","/products"),s.searchParams.set("search",t),i=s.toString()}else i="/products?search="+encodeURIComponent(t);r+='<a href="'+i+'" class="search-view-all">'+(n.viewAllResults||"View all results")+" ("+e.length+")</a>"}o.innerHTML=r}(D(e),e)},200)}),a.addEventListener("keypress",function(e){if("Enter"===e.key){const e=this.value.trim();if(e.length>=2){if(window.location.pathname.includes("preview-fullscreen")){const t=new URL(window.location.href);t.searchParams.set("page","/products"),t.searchParams.set("search",e),window.location.href=t.toString()}else window.location.href="/products?search="+encodeURIComponent(e)}}});const e=document.getElementById("mobile-search-submit");e&&e.addEventListener("click",function(e){e.preventDefault();const t=a.value.trim();if(t.length>=2){if(window.location.pathname.includes("preview-fullscreen")){const e=new URL(window.location.href);e.searchParams.set("page","/products"),e.searchParams.set("search",t),window.location.href=e.toString()}else window.location.href="/products?search="+encodeURIComponent(t)}})}document.addEventListener("click",function(e){!t.classList.contains("active")||e.target.closest("#mobile-search-panel")||e.target.closest("#mobile-search-toggle")||t.classList.remove("active")})}}function H(){const t=document.getElementById("account-not-logged-in"),a=document.getElementById("account-logged-in"),i=document.getElementById("account-email"),s=document.getElementById("logout-btn"),d=document.getElementById("orders-loading"),c=document.getElementById("orders-empty"),l=document.getElementById("orders-list"),u=document.getElementById("profile-display"),p=document.getElementById("profile-form"),m=document.getElementById("edit-profile-btn"),g=document.getElementById("save-profile-btn"),y=document.getElementById("cancel-profile-btn"),f=document.getElementById("profile-name"),h=document.getElementById("profile-phone"),v=document.getElementById("edit-name"),w=document.getElementById("edit-phone"),b=document.getElementById("addresses-list"),C=(document.getElementById("addresses-empty"),document.getElementById("add-address-btn")),E=document.getElementById("address-modal-overlay"),L=document.getElementById("address-modal-title"),S=document.getElementById("address-modal-close"),I=document.getElementById("save-address-btn"),P=document.getElementById("cancel-address-btn"),k=document.getElementById("address-edit-id"),A=document.getElementById("address-label"),x=document.getElementById("address-street"),B=document.getElementById("address-apartment"),T=document.getElementById("address-city"),_=document.getElementById("address-zip"),F=document.getElementById("address-default");if(!t||!a)return;const z=localStorage.getItem("zappy_customer_token"),M=localStorage.getItem("zappy_customer_email");let O={name:"",phone:"",addresses:[]};if(!z)return t.style.display="block",void(a.style.display="none");function N(e,t){const o=document.querySelector(".toast");o&&o.remove();const n=document.createElement("div");n.className="toast "+(t||""),n.textContent=e,document.body.appendChild(n),setTimeout(function(){n.classList.add("show")},10),setTimeout(function(){n.classList.remove("show"),setTimeout(function(){n.remove()},300)},3e3)}function D(){if(!b)return;if(!O.addresses||0===O.addresses.length)return void(b.innerHTML='<div class="addresses-empty" id="addresses-empty"><p>'+(n.noAddresses||"No saved addresses")+"</p></div>");const e={home:n.home||"Home",work:n.work||"Work",other:n.other||"Other"};b.innerHTML=O.addresses.map(function(t){const o=e[t.label]||t.label||n.other||"Other",a=t.isDefault;return'<div class="address-card'+(a?" default":"")+'" data-id="'+t.id+'"><div class="address-card-header"><span class="address-label-tag">'+o+"</span>"+(a?'<span class="address-default-badge">'+(n.defaultAddress||"Default")+"</span>":"")+'</div><div class="address-card-body"><div>'+(t.street||"")+(t.apartment?", "+t.apartment:"")+"</div><div>"+(t.city||"")+(t.zip?" "+t.zip:"")+'</div></div><div class="address-card-actions"><button class="btn-icon btn-edit-address" data-id="'+t.id+'"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg><span>'+(n.editAddress||"Edit")+"</span></button>"+(a?"":'<button class="btn-icon btn-default-address" data-id="'+t.id+'"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg><span>'+(n.setAsDefault||"Set as Default")+"</span></button>")+'<button class="btn-icon btn-delete btn-delete-address" data-id="'+t.id+'"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg><span>'+(n.deleteAddress||"Delete")+"</span></button></div></div>"}).join(""),b.querySelectorAll(".btn-edit-address").forEach(function(e){e.addEventListener("click",function(){q(this.getAttribute("data-id"))})}),b.querySelectorAll(".btn-default-address").forEach(function(e){e.addEventListener("click",function(){!async function(e){const t=O.addresses.map(function(t){return Object.assign({},t,{isDefault:t.id===e})});try{const e=await fetch(o("/api/ecommerce/customers/me"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z},body:JSON.stringify({addresses:t})});(await e.json()).success&&(O.addresses=t,D(),N(n.addressSaved||"Default address updated","success"))}catch(e){console.error("Failed to set default address:",e),N("Error updating default address","error")}}(this.getAttribute("data-id"))})}),b.querySelectorAll(".btn-delete-address").forEach(function(e){e.addEventListener("click",function(){!async function(e){if(!confirm(n.confirmDelete||"Are you sure you want to delete this address?"))return;const t=O.addresses.filter(function(t){return t.id!==e});try{const e=await fetch(o("/api/ecommerce/customers/me"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z},body:JSON.stringify({addresses:t})});(await e.json()).success&&(O.addresses=t,D(),N(n.addressDeleted||"Address deleted","success"))}catch(e){console.error("Failed to delete address:",e),N("Error deleting address","error")}}(this.getAttribute("data-id"))})})}function q(e){const t=!!e;if(L&&(L.textContent=t?n.editAddress||"Edit Address":n.addAddress||"Add Address"),k&&(k.value=e||""),A&&(A.value="home"),x&&(x.value=""),B&&(B.value=""),T&&(T.value=""),_&&(_.value=""),F&&(F.checked=!1),t&&O.addresses){const t=O.addresses.find(function(t){return t.id===e});t&&(A&&(A.value=t.label||"home"),x&&(x.value=t.street||""),B&&(B.value=t.apartment||""),T&&(T.value=t.city||""),_&&(_.value=t.zip||""),F&&(F.checked=!!t.isDefault))}E&&(E.style.display="flex")}function U(){E&&(E.style.display="none")}t.style.display="none",a.style.display="block",i&&M&&(i.textContent=M),s&&s.addEventListener("click",function(){localStorage.removeItem("zappy_customer_token"),localStorage.removeItem("zappy_customer_email");const t=window.location.href;if(t.includes("/api/website/preview")){const o=t.includes("preview-fullscreen")?"preview-fullscreen":"preview";window.location.href="/api/website/"+o+"/"+e+"?page="+encodeURIComponent("/")}else window.location.href="/"}),async function(){try{const e=await fetch(o("/api/ecommerce/customers/me"),{headers:{Authorization:"Bearer "+z}}),t=await e.json();t.success&&t.data&&(O={name:t.data.name||"",phone:t.data.phone||"",addresses:t.data.addresses||[]},f&&(f.textContent=O.name||t.data.email||"-"),h&&(h.textContent=O.phone||"-"),i&&(i.textContent=O.name||t.data.email||""),D())}catch(e){console.error("Failed to load profile:",e)}}(),m&&m.addEventListener("click",function(){v&&(v.value=O.name||""),w&&(w.value=O.phone||""),u&&(u.style.display="none"),p&&(p.style.display="flex"),m&&(m.style.display="none")}),y&&y.addEventListener("click",function(){u&&(u.style.display="flex"),p&&(p.style.display="none"),m&&(m.style.display="inline-flex")}),g&&g.addEventListener("click",async function(){const e=v?v.value.trim():"",t=w?w.value.trim():"";g.disabled=!0,g.textContent=n.saving||"Saving...";try{const a=await fetch(o("/api/ecommerce/customers/me"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z},body:JSON.stringify({name:e,phone:t})}),r=await a.json();if(!r.success)throw new Error(r.error||"Failed to update profile");O.name=e,O.phone=t,f&&(f.textContent=e||"-"),h&&(h.textContent=t||"-"),u&&(u.style.display="flex"),p&&(p.style.display="none"),m&&(m.style.display="inline-flex"),N(n.profileUpdated||"Profile updated successfully","success")}catch(e){console.error("Failed to save profile:",e),N(e.message||"Error saving profile","error")}finally{g.disabled=!1,g.textContent=n.saveChanges||"Save Changes"}}),C&&C.addEventListener("click",function(){q(null)}),S&&S.addEventListener("click",U),P&&P.addEventListener("click",U),E&&E.addEventListener("click",function(e){e.target===E&&U()}),I&&I.addEventListener("click",async function(){const e=x?x.value.trim():"",t=T?T.value.trim():"";if(!e||!t)return void N(r?"× × ×œ××œ× ×¨×—×•×‘ ×•×¢×™×¨":"Please fill in street and city","error");const a=k?k.value:"",i=!!a,s=!!F&&F.checked,d={id:i?a:"addr_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),label:A?A.value:"home",street:e,apartment:B?B.value.trim():"",city:t,zip:_?_.value.trim():"",isDefault:s};let c=O.addresses?O.addresses.slice():[];i?c=c.map(function(e){return e.id===a?d:e}):c.push(d),s&&(c=c.map(function(e){return e.id!==d.id?Object.assign({},e,{isDefault:!1}):e})),I.disabled=!0,I.textContent=n.saving||"Saving...";try{const e=await fetch(o("/api/ecommerce/customers/me"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+z},body:JSON.stringify({addresses:c})}),t=await e.json();if(!t.success)throw new Error(t.error||"Failed to save address");O.addresses=c,D(),U(),N(n.addressSaved||"Address saved successfully","success")}catch(e){console.error("Failed to save address:",e),N(e.message||"Error saving address","error")}finally{I.disabled=!1,I.textContent=n.saveChanges||"Save Changes"}}),async function(){if(!d||!l)return;try{const e=await fetch(o("/api/ecommerce/customers/me/orders"),{headers:{Authorization:"Bearer "+z}}),t=await e.json();if(d.style.display="none",!t.success||!t.data||0===t.data.length)return void(c&&(c.style.display="block"));l.style.display="block",l.innerHTML=t.data.map(function(e){const t="status"+(e.payment_status||e.status||"pending").charAt(0).toUpperCase()+(e.payment_status||e.status||"pending").slice(1),o=n[t]||e.payment_status||e.status||"pending",a=new Date(e.created_at).toLocaleDateString(r?"he-IL":"en-US");let i=e.items;if("string"==typeof i)try{i=JSON.parse(i)}catch(e){i=[]}i=i||[];const s=parseFloat(e.total||e.total_amount||0);return'<div class="order-card"><div class="order-card-header"><span class="order-number">#'+(e.order_number||e.id.slice(0,8))+'</span><span class="order-status status-'+(e.payment_status||e.status)+'">'+o+'</span></div><div class="order-card-body"><div class="order-info-row"><span class="order-label">'+(n.orderDate||"Date")+':</span><span class="order-value">'+a+'</span></div><div class="order-info-row"><span class="order-label">'+(n.orderTotal||"Total")+':</span><span class="order-value">'+n.currency+s.toFixed(2)+"</span></div>"+(i.length>0?'<div class="order-items-summary">'+i.slice(0,3).map(function(e){return'<span class="order-item-name">'+(e.name||e.productName||"Item")+(e.quantity>1?" x"+e.quantity:"")+"</span>"}).join(", ")+(i.length>3?"...":"")+"</div>":"")+"</div></div>"}).join("")}catch(e){console.error("Failed to load orders:",e),d.style.display="none",c&&(c.querySelector("p").textContent=n.errorLoading||"Error loading orders",c.style.display="block")}}()}function j(){m(),v(),document.querySelectorAll(".filter-btn").forEach(function(e){e.addEventListener("click",function(){w(e.getAttribute("data-category"))})}),S(),async function(){const t=document.getElementById("shipping-methods");if(t)try{const a=await fetch(o("/api/ecommerce/storefront/shipping?websiteId="+e)),r=await a.json();if(P=r.data||[],!P.length)return void(t.innerHTML='<div class="no-shipping">'+(n.noShippingMethods||"No shipping options available")+"</div>");if(t.innerHTML=P.map((e,t)=>{const o=e.is_pickup,a=0===parseFloat(e.price),r=e.conditions?.freeAbove&&F()>=e.conditions.freeAbove,i=a||r?n.free||"FREE":n.currency+e.price,s=e.estimated_days?" ("+e.estimated_days+" "+n.days+")":"",d=o?"ğŸ“ ":"ğŸšš ",c=o&&e.pickup_address?.street?'<div class="shipping-address">'+e.pickup_address.street+", "+(e.pickup_address.city||"")+"</div>":"",l=e.conditions?.freeAbove&&!r?'<div class="shipping-free-note">'+(n.freeAbove||"Free above")+" "+n.currency+e.conditions.freeAbove+"</div>":"";return'<label class="shipping-option'+(0===t?" selected":"")+'" data-method-id="'+e.id+'"><input type="radio" name="shipping" value="'+e.id+'"'+(0===t?" checked":"")+' onchange="window.zappySelectShipping(this.value)"><div class="shipping-info"><div class="shipping-name">'+d+e.name+s+"</div>"+(e.description?'<div class="shipping-desc">'+e.description+"</div>":"")+c+l+'</div><div class="shipping-price'+(a||r?" free":"")+'">'+i+"</div></label>"}).join(""),P.length>0){I=P[0];const e=document.getElementById("shipping-address-section");e&&(e.style.display=I.is_pickup?"none":"block"),z()}}catch(e){console.error("Failed to load shipping methods",e),t.innerHTML='<div class="error">'+(n.errorLoading||"Error loading options")+"</div>"}}(),async function(){const t=document.getElementById("payment-container");if(t)try{const n=await fetch(o("/api/ecommerce/storefront/payment-status?websiteId="+e)),a=await n.json();if(x=a.data?.isConfigured||!1,A=a.data?.methods||[],!x||!A.length)return void(t.innerHTML='<div class="payment-not-configured"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg><span>'+(r?"×ª×©×œ×•× ××§×•×•×Ÿ ×œ× ××•×’×“×¨. ×¦×¨×• ×§×©×¨ ×¢× ×‘×¢×œ ×”××ª×¨.":"Online payment not configured. Please contact the store owner.")+"</span></div>");t.innerHTML=A.map((e,t)=>{const o=r?e.name:e.nameEn,n="credit-card"===e.icon?'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>':"";return'<label class="payment-option'+(0===t?" selected":"")+'" data-method-id="'+e.id+'"><input type="radio" name="payment" value="'+e.id+'"'+(0===t?" checked":"")+' onchange="window.zappySelectPayment(this.value)"><div class="payment-info"><div class="payment-icon">'+n+'</div><div class="payment-name">'+o+"</div></div></label>"}).join(""),A.length>0&&(k=A[0])}catch(e){console.error("Failed to load payment methods",e),t.innerHTML='<div class="error">'+(n.errorLoading||"Error loading options")+"</div>"}}(),z(),q(),R(),U(),function(){if(window.innerWidth>768)return;const e=document.querySelectorAll('a[href="/products"], a[href*="/products"]');if(!e.length)return;const t=document.getElementById("zappy-category-links");let n=[];if(t){t.querySelectorAll("a").forEach(function(e){n.push({name:e.textContent.trim(),href:e.href})})}if(0===n.length){const t=window.ZAPPY_WEBSITE_ID;t&&fetch(o("/api/ecommerce/"+t+"/categories")).then(function(e){return e.json()}).then(function(t){t.categories&&t.categories.length>0&&(n=t.categories.map(function(e){return{name:e.name,href:"/category/"+(e.slug||e.id)}}),V(e,n))}).catch(function(){})}else V(e,n)}(),function(){document.querySelectorAll("#cart-drawer-toggle, [data-cart-toggle], .cart-link.nav-cart, a.nav-cart").forEach(function(e){e.hasAttribute("data-cart-init")||(e.setAttribute("data-cart-init","true"),e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),E()}))});var e=document.getElementById("cart-drawer-close");e&&e.addEventListener("click",L);var t=document.getElementById("cart-drawer-overlay");t&&t.addEventListener("click",L),document.addEventListener("keydown",function(e){"Escape"===e.key&&L()}),C()}(),B(),function(){const t=document.getElementById("coupon-toggle-btn"),a=document.getElementById("coupon-input-wrapper"),r=document.getElementById("coupon-close-btn"),i=document.getElementById("apply-coupon-btn"),s=document.getElementById("remove-coupon-btn"),d=document.getElementById("coupon-code-input"),c=document.getElementById("coupon-applied-row");t&&a&&(t.addEventListener("click",function(){"none"===a.style.display&&(a.style.display="block",t.style.display="none",d&&d.focus())}),r&&r.addEventListener("click",function(){a.style.display="none",t.style.display="flex",d&&(d.value="");const e=document.getElementById("coupon-error");e&&(e.style.display="none")}),i&&d&&(i.addEventListener("click",async function(){const r=d.value.trim();if(r){i.disabled=!0,i.textContent="...";try{const i=F(),s=await fetch(o("/api/ecommerce/storefront/validate-coupon"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteId:e,code:r,subtotal:i})}),d=await s.json();if(!d.success||!d.data?.valid){const e=document.getElementById("coupon-error");let t=n.invalidCoupon||"Invalid coupon code";return"expired"===d.data?.error?t=n.couponExpired||"Coupon has expired":"min_order"===d.data?.error&&(t=(n.couponMinOrder||"Minimum order amount")+": "+n.currency+d.data.minOrderAmount),void(e&&(e.textContent=t,e.style.display="block",setTimeout(function(){e.style.display="none"},5e3)))}T=d.data.coupon,_=T.discountAmount||0,a.style.display="none",t.style.display="none",c.style.display="flex",document.getElementById("applied-coupon-code").textContent=T.code,document.getElementById("coupon-error").style.display="none",z()}catch(e){console.error("Failed to validate coupon",e);const t=document.getElementById("coupon-error");t&&(t.textContent=n.errorLoading||"Error",t.style.display="block")}finally{i.disabled=!1,i.textContent=n.applyCoupon||"Apply"}}}),d.addEventListener("keypress",function(e){"Enter"===e.key&&(e.preventDefault(),i.click())}),s&&s.addEventListener("click",function(){T=null,_=0,c.style.display="none",t.style.display="flex",d&&(d.value=""),z()})))}(),async function(){const e=window.location.pathname,t=(window.location.search.includes("page="),new URLSearchParams(window.location.search).get("page"));if("/order-success"!==e&&!e.endsWith("/order-success")&&"/order-success"!==t&&"order-success"!==t)return;try{if(window.self!==window.top)return void(window.top.location.href=window.location.href)}catch(e){try{window.parent.postMessage({type:"zappy_order_success",url:window.location.href},"*")}catch(e){console.warn("Could not communicate with parent frame:",e)}}const a=document.getElementById("order-number-value"),r=document.getElementById("order-details-section"),s=document.getElementById("order-items-list"),d=document.getElementById("order-totals-summary");if(!a)return;const c=new URLSearchParams(window.location.search).get("ref");if(!c)return void(a.textContent=n.orderNotFound||"Order not found");const l=c.split("_"),u=l.length>=3?l[2]:c;a.textContent="#"+u;const g=window.ZAPPY_WEBSITE_ID;if(g)try{const e=await fetch(o("/api/ecommerce/confirm-order/"+encodeURIComponent(c)),{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();t.success?(console.log("âœ… Order confirmed:",t.data),t.data.orderNumber&&(a.textContent="#"+t.data.orderNumber)):console.warn("Order confirmation response:",t)}catch(e){console.error("Failed to confirm order:",e)}if(g&&r&&s){const e="zappy_pending_order_"+c;let t=localStorage.getItem(e);if(!t)try{const e=await fetch(o("/api/ecommerce/pending-order/"+encodeURIComponent(c))),n=await e.json();n.success&&n.data&&(t=JSON.stringify(n.data))}catch(e){console.error("Failed to fetch pending order from API:",e)}if(t)try{const o=JSON.parse(t);if(r.style.display="block",o.cartItems&&o.cartItems.length>0&&(s.innerHTML=o.cartItems.map(function(e){var t=e.sale_price&&parseFloat(e.sale_price)<parseFloat(e.price)?parseFloat(e.sale_price):parseFloat(e.price),o=e.variantName?" ("+e.variantName+")":"";return'<div class="order-success-item"><span>'+e.name+o+" x "+e.quantity+"</span><span>"+n.currency+(t*e.quantity).toFixed(2)+"</span></div>"}).join("")),d){let e="<div><span>"+(n.subtotal||"Subtotal")+":</span><span>"+n.currency+parseFloat(o.subtotal||0).toFixed(2)+"</span></div>";o.shippingCost>0&&(e+="<div><span>"+(n.shipping||"Shipping")+":</span><span>"+n.currency+parseFloat(o.shippingCost).toFixed(2)+"</span></div>"),o.discount>0&&(e+="<div><span>"+(n.discount||"Discount")+":</span><span>-"+n.currency+parseFloat(o.discount).toFixed(2)+"</span></div>"),e+='<div class="order-total-final"><span>'+(n.paidAmount||"Amount Paid")+":</span><span>"+n.currency+parseFloat(o.total||0).toFixed(2)+"</span></div>",d.innerHTML=e}localStorage.removeItem(e)}catch(e){console.error("Error parsing pending order data:",e)}}i=[],p(),m()}(),function(){const t=document.getElementById("send-otp-btn"),a=document.getElementById("verify-otp-btn"),i=document.getElementById("login-email"),s=document.getElementById("otp-code"),d=document.querySelector(".login-form"),c=document.querySelector(".otp-form");if(!t||!i)return;let l="";t.addEventListener("click",async function(a){a.preventDefault();const s=u(i.value);if(s)if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)){t.disabled=!0,t.textContent=r?"×©×•×œ×—...":"Sending...";try{const t=await fetch(o("/api/ecommerce/customers/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteId:e,email:s})}),n=await t.json();if(!n.success)throw new Error(n.error||"Failed to send code");l=s,d&&(d.style.display="none"),c&&(c.style.display="block"),alert(r?"×§×•×“ ××™××•×ª × ×©×œ×— ×œ××™××™×™×œ ×©×œ×š":"Verification code sent to your email")}catch(e){console.error("Send OTP failed:",e),alert(r?"×©×’×™××” ×‘×©×œ×™×—×ª ×”×§×•×“. × ×¡×” ×©×•×‘.":"Failed to send code. Please try again.")}finally{t.disabled=!1,t.textContent=n.sendCode||(r?"×©×œ×— ×§×•×“":"Send Code")}}else alert(r?"× × ×œ×”×–×™×Ÿ ×›×ª×•×‘×ª ××™××™×™×œ ×ª×§×™× ×”":"Please enter a valid email address");else alert(r?"× × ×œ×”×–×™×Ÿ ×›×ª×•×‘×ª ××™××™×™×œ":"Please enter an email address")}),a&&s&&a.addEventListener("click",async function(t){t.preventDefault();const i=s.value.trim();if(i)if(6===i.length){a.disabled=!0,a.textContent=r?"××××ª...":"Verifying...";try{const t=await fetch(o("/api/ecommerce/customers/verify-otp"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteId:e,email:l,code:i})}),n=await t.json();if(!n.success)throw new Error(n.error||"Invalid code");localStorage.setItem("zappy_customer_token",n.token),localStorage.setItem("zappy_customer_email",l),alert(r?"×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!":"Successfully logged in!");const a=sessionStorage.getItem("zappy_login_return");sessionStorage.removeItem("zappy_login_return");let s=a&&"/login"!==a?a:"/products";const d=window.location.href;if(d.includes("/api/website/preview")){const t="/api/website/"+(d.includes("preview-fullscreen")?"preview-fullscreen":"preview")+"/"+e+"?page="+encodeURIComponent(s);window.location.href=t}else window.location.href=s}catch(e){console.error("Verify OTP failed:",e),alert(r?"×§×•×“ ×©×’×•×™ ××• ×¤×’ ×ª×•×§×£. × ×¡×” ×©×•×‘.":"Invalid or expired code. Please try again.")}finally{a.disabled=!1,a.textContent=n.verify||(r?"×××ª":"Verify")}}else alert(r?"×”×§×•×“ ×—×™×™×‘ ×œ×”×™×•×ª 6 ×¡×¤×¨×•×ª":"Code must be 6 digits");else alert(r?"× × ×œ×”×–×™×Ÿ ××ª ×§×•×“ ×”××™××•×ª":"Please enter the verification code")})}(),H(),function(){const e=localStorage.getItem("zappy_customer_token"),t=document.querySelectorAll('a[href="/login"]'),o=document.querySelectorAll('a[href="/account"]');e?t.forEach(function(e){e.href="/account"}):o.forEach(function(e){e.href="/login"})}()}function V(e,t){t.length&&e.forEach(function(e){if(e.parentElement.querySelector(".mobile-categories-submenu"))return;if(!e.closest('.nav-menu, .mobile-menu, .mobile-nav, [class*="mobile"], [class*="nav-menu"]'))return;const o=document.createElement("div");o.className="mobile-categories-submenu",o.innerHTML=t.map(function(e){return'<a href="'+e.href+'">'+e.name+"</a>"}).join("");const n=e.innerHTML;e.innerHTML='<span class="products-menu-toggle">'+n+"</span>",e.classList.add("products-menu-item"),e.parentElement.insertBefore(o,e.nextSibling),e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();const n=e.querySelector(".products-menu-toggle");n&&n.classList.toggle("active"),o.classList.toggle("active")})})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",j):j(),"undefined"!=typeof zappyI18n&&"function"==typeof zappyI18n.onLanguageChange&&(zappyI18n.onLanguageChange(function(e,t){console.log("[E-COMMERCE MAIN] Language changed from "+t+" to "+e+", refreshing products..."),v(),N()}),console.log("[E-COMMERCE MAIN] Registered language change callback for products refresh"))}();const isCatalogMode=!1;function getApiBase(){var e=(window.ZAPPY_API_BASE||"").replace(/\/$/,""),t=window.location?window.location.pathname:"";return-1!==t.indexOf("/preview")||-1!==t.indexOf("/preview-fullscreen")?window.location.origin:e}function buildApiUrl(e){"/"!==e.charAt(0)&&(e="/"+e);var t=getApiBase();return t?t+e:e}function getCurrentLanguage(){if("undefined"!=typeof i18next&&i18next.language)return i18next.language;var e=document.documentElement.getAttribute("lang");return e||null}function buildApiUrlWithLang(e){var t=buildApiUrl(e),o=getCurrentLanguage();return o&&(t+=(-1===t.indexOf("?")?"?":"&")+"lang="+encodeURIComponent(o)),t}let additionalJsProductLayout="standard",additionalJsSettingsFetched=!1;async function fetchAdditionalJsSettings(e){if(additionalJsSettingsFetched&&!e)return;const t=window.ZAPPY_WEBSITE_ID;if(t)try{const e=await fetch(buildApiUrlWithLang("/api/ecommerce/storefront/settings?websiteId="+t)),o=await e.json();o.success&&o.data&&(o.data.productLayout&&(additionalJsProductLayout=o.data.productLayout),handleDynamicAnnouncementBar(o.data.announcementBar),additionalJsSettingsFetched=!0)}catch(e){console.warn("Failed to fetch store settings:",e)}}function handleDynamicAnnouncementBar(e){var t=document.querySelector(".zappy-announcement-bar");if(e){if(e.enabled){if(e.messages){if(0!==e.messages.length){for(var o=[],n=0;n<e.messages.length;n++){var a=e.messages[n];if(a)""!==a.trim()&&o.push(a)}if(0!==o.length){var r=e.bgColor||"#000000",i=e.textColor||"#ffffff",s=e.interval||4e3;if(t)t.style.backgroundColor=r,t.style.color=i;else{if(!document.getElementById("zappy-announcement-bar-style")){var d=document.createElement("style");d.id="zappy-announcement-bar-style",d.textContent=".zappy-announcement-bar { background-color: "+r+"; color: "+i+"; position: fixed; top: 0; left: 0; right: 0; width: 100%; text-align: center; padding: 10px 20px; font-size: 14px; font-weight: 500; line-height: 1.4; box-sizing: border-box; z-index: 1001; min-height: 40px; display: flex; align-items: center; justify-content: center; } .zappy-announcement-bar .zappy-announcement-message { position: absolute; opacity: 0; transition: opacity 0.5s ease-in-out; width: 100%; left: 0; right: 0; padding: 0 20px; box-sizing: border-box; } .zappy-announcement-bar .zappy-announcement-message.active { opacity: 1; }",document.head.appendChild(d)}var c=document.createElement("div");c.className="zappy-announcement-bar";for(var l="",u=0;u<o.length;u++){l+='<span class="zappy-announcement-message'+(0===u?" active":"")+'">'+o[u].replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"}if(c.innerHTML=l,document.body.insertBefore(c,document.body.firstChild),o.length>1){var p=0;setInterval(function(){var e=c.querySelectorAll(".zappy-announcement-message");e[p].classList.remove("active"),e[p=(p+1)%e.length].classList.add("active")},s)}"function"==typeof setupFixedHeaders&&setTimeout(setupFixedHeaders,100)}}else t&&t.remove()}else if(t){t.remove();var m=document.getElementById("zappy-announcement-bar-style");m&&m.remove()}}else if(t){t.remove();var g=document.getElementById("zappy-announcement-bar-style");g&&g.remove()}}else if(t){t.remove();var y=document.getElementById("zappy-announcement-bar-style");y&&y.remove()}}else if(t){t.remove();var f=document.getElementById("zappy-announcement-bar-style");f&&f.remove()}}async function loadFeaturedProducts(){const e=document.getElementById("zappy-featured-products");if(!e)return;const t=window.ZAPPY_WEBSITE_ID;if(!t)return;await fetchAdditionalJsSettings();const o={products:"Products",ourProducts:"Our Products",featuredProducts:"Featured Products",noFeaturedProducts:"No featured products yet. Check out all our products!",featuredCategories:"Shop by Category",all:"All",featured:"Featured",new:"New",sale:"Sale",loadingProducts:"Loading products...",cart:"Cart",yourCart:"Your Cart",emptyCart:"Cart is empty",total:"Total",proceedToCheckout:"Proceed to Checkout",checkout:"Checkout",customerInfo:"Customer Info",fullName:"Full Name",email:"Email",phone:"Phone",shippingAddress:"Shipping Address",street:"Street Address",apartment:"Apt, Floor, Unit",city:"City",zip:"ZIP Code",shippingMethod:"Shipping Method",loadingShipping:"Loading shipping methods...",payment:"Payment",loadingPayment:"Loading payment options...",orderSummary:"Order Summary",subtotal:"Subtotal",vat:"VAT",vatIncluded:"VAT Included",shipping:"Shipping",discount:"Discount",totalToPay:"Total",placeOrder:"Place Order",login:"Login",customerLogin:"Customer Login",enterEmail:"Enter your email and we'll send you a login code",emailAddress:"Email Address",sendCode:"Send Code",enterCode:"Enter the code sent to your email",verificationCode:"Verification Code",verify:"Verify",returnPolicy:"Return Policy",addToCart:"Add to Cart",addedToCart:"Product added to cart!",remove:"Remove",noProducts:"No products to display",errorLoading:"Error loading",days:"days",currency:"$",free:"FREE",freeAbove:"Free above",noShippingMethods:"No shipping options available",viewAllResults:"View all results",searchProducts:"Search products",productDetails:"Product Details",viewDetails:"View Details",inStock:"In Stock",outOfStock:"Out of Stock",sku:"SKU",category:"Category",relatedProducts:"Related Products",productNotFound:"Product not found",backToProducts:"Back to Products",home:"Home",quantity:"Quantity",couponCode:"Coupon Code",enterCouponCode:"Enter coupon code",applyCoupon:"Apply",removeCoupon:"Remove",couponApplied:"Coupon applied successfully!",invalidCoupon:"Invalid coupon code",couponExpired:"Coupon has expired",couponMinOrder:"Minimum order amount",alreadyHaveAccount:"Already have an account?",loginHere:"Login here",loggedInAs:"Logged in as:",logout:"Logout",haveCouponCode:"I have a coupon code",orderSuccess:"Order Received!",thankYouOrder:"Thank you for your order",orderNumber:"Order Number",orderConfirmation:"A confirmation email has been sent to you",orderProcessing:"Your order is being processed. We'll notify you when it ships.",continueShopping:"Continue Shopping",orderDetails:"Order Details",loadingOrder:"Loading order details...",orderNotFound:"Order not found",orderItems:"Order Items",paidAmount:"Amount Paid",myAccount:"My Account",accountWelcome:"Welcome",yourOrders:"Your Orders",noOrders:"No orders yet",orderDate:"Date",orderStatus:"Status",orderTotal:"Total",viewOrder:"View Order",statusPending:"Pending Payment",statusPaid:"Paid",statusProcessing:"Processing",statusShipped:"Shipped",statusDelivered:"Delivered",statusCancelled:"Cancelled",notLoggedIn:"Not Logged In",pleaseLogin:"Please login to view your account",personalDetails:"Personal Details",editProfile:"Edit Profile",name:"Name",saveChanges:"Save Changes",cancel:"Cancel",addresses:"Addresses",addAddress:"Add Address",editAddress:"Edit Address",deleteAddress:"Delete Address",setAsDefault:"Set as Default",defaultAddress:"Default Address",addressLabel:"Address Label",work:"Work",other:"Other",noAddresses:"No saved addresses",confirmDelete:"Are you sure you want to delete?",profileUpdated:"Profile updated successfully",addressSaved:"Address saved successfully",addressDeleted:"Address deleted",saving:"Saving...",selectVariant:"Select option",variantUnavailable:"Unavailable",color:"Color",size:"Size",material:"Material",style:"Style",weight:"Weight",capacity:"Capacity",length:"Length",inquiryAbout:"Inquiry about",sendInquiry:"Send Inquiry",callNow:"Call Now",specifications:"Specifications",businessPhone:"[business_phone]",businessEmail:"[business_email]"};try{const n=await fetch(buildApiUrlWithLang("/api/ecommerce/storefront/products?websiteId="+t+"&featured=true&limit=6")),a=await n.json();if(!a.success||!a.data?.length)return void(e.innerHTML='<div class="no-featured-products">'+(o.noFeaturedProducts||"No featured products yet. Check out all our products!")+"</div>");renderProductGrid(e,a.data,o,!0)}catch(t){console.error("Failed to load featured products",t),e.innerHTML='<div class="empty-cart">'+o.errorLoading+"</div>"}}async function loadFeaturedCategories(){const e=document.getElementById("zappy-featured-categories");if(!e)return;const t=window.ZAPPY_WEBSITE_ID;if(t)try{const o=await fetch(buildApiUrlWithLang("/api/ecommerce/storefront/featured-categories?websiteId="+t)),n=await o.json();if(!n.success||!n.data?.length){const e=document.getElementById("featured-categories");return void(e&&e.remove())}e.innerHTML=n.data.map(function(e){const t=resolveProductImageUrl(e.image)||"";return'<a href="'+("/category/"+(e.slug||e.id))+'" class="category-block" data-category-id="'+e.id+'" data-category-slug="'+(e.slug||"")+'"><div class="category-block-bg" style="background-image: url(\''+t+'\')"></div><div class="category-block-overlay"></div><div class="category-block-content"><span class="category-block-name">'+e.name+"</span></div></a>"}).join("")}catch(e){console.error("Failed to load featured categories",e);const t=document.getElementById("featured-categories");t&&t.remove()}}function getEcomText(e,t){if("undefined"!=typeof zappyI18n&&"function"==typeof zappyI18n.t){var o=zappyI18n.t("ecom_"+e);if(o&&o!=="ecom_"+e)return o}return t}function renderProductGrid(e,t,o,n){var a=additionalJsProductLayout||"standard";n||(e.className="product-grid layout-"+a);var r=getEcomText("addToCart",o.addToCart);e.innerHTML=t.map(e=>{const t=!1!==e.custom_fields?.showPrice,n=e.sale_price&&parseFloat(e.sale_price)<parseFloat(e.price),a=t?n?o.currency+parseFloat(e.sale_price).toFixed(2)+'<span class="original-price">'+o.currency+parseFloat(e.price).toFixed(2)+"</span>":o.currency+parseFloat(e.price).toFixed(2):"";var i=e.images&&e.images[0]?window.resolveProductImageUrl?window.resolveProductImageUrl(e.images[0]):e.images[0]:"",s=[];e.tags&&e.tags.length&&e.tags.forEach(function(e){var t=e.toLowerCase();"sale"===t||"××‘×¦×¢"===t?s.push('<span class="product-tag tag-sale">'+e+"</span>"):"new"===t||"×—×“×©"===t?s.push('<span class="product-tag tag-new">'+e+"</span>"):"featured"===t||"××•××œ×¥"===t?s.push('<span class="product-tag tag-featured">'+e+"</span>"):s.push('<span class="product-tag">'+e+"</span>")});var d=s.length>0?'<div class="product-tags">'+s.join("")+"</div>":"",c="",l=i?'<img src="'+i+'" alt="'+e.name+'">':'<div class="no-image-placeholder">ğŸ“¦</div>',u=additionalJsProductLayout||"standard",p=t?'<div class="price">'+a+"</div>":"";return c="compact"===u?d+'<a href="/product/'+(e.slug||e.id)+'" class="product-card-link">'+l+"<h3>"+e.name+"</h3>"+p+"</a>":"detailed"===u?d+'<a href="/product/'+(e.slug||e.id)+'" class="product-card-link">'+l+"<h3>"+e.name+"</h3><p>"+(e.description||"").substring(0,150)+(e.description?.length>150?"...":"")+"</p>"+p+'</a><button class="add-to-cart" onclick="event.stopPropagation(); window.zappyHandleAddToCart('+JSON.stringify(e).replace(/"/g,"&quot;")+')">'+r+"</button>":d+'<a href="/product/'+(e.slug||e.id)+'" class="product-card-link">'+l+"<h3>"+e.name+"</h3><p>"+(e.description||"").substring(0,80)+(e.description?.length>80?"...":"")+"</p>"+p+"</a>",'<div class="product-card '+u+'" data-product-id="'+e.id+'">'+c+"</div>"}).join("")}async function loadCatalogCategories(){const e=document.getElementById("zappy-category-links"),t=document.getElementById("zappy-nav-category-links");if(!e&&!t)return;const o=window.ZAPPY_WEBSITE_ID;if(o)try{const n=await fetch(buildApiUrlWithLang("/api/ecommerce/storefront/categories?websiteId="+o)),a=await n.json();if(!a.success||!a.data?.length)return;const r=a.data.map(e=>{const t="/category/"+(e.slug||e.id);return'<li data-category-id="'+e.id+'" data-category-slug="'+(e.slug||"")+'"><a href="'+t+'">'+e.name+"</a></li>"}).join(""),i=a.data.map(e=>'<a href="'+("/category/"+(e.slug||e.id))+'" class="catalog-menu-item" data-category-id="'+e.id+'" data-category-slug="'+(e.slug||"")+'">'+e.name+"</a>").join("");t&&(t.querySelectorAll("li[data-category-id]").forEach(function(e){e.remove()}),t.insertAdjacentHTML("beforeend",r)),e&&(e.querySelectorAll("[data-category-id]").forEach(function(e){e.remove()}),e.insertAdjacentHTML("beforeend",i))}catch(e){console.error("Failed to load categories",e)}}function initEcommerceMobileMenu(){const e=document.querySelector(".mobile-toggle, #mobileToggle"),t=document.querySelector("#navMenu, .nav-menu");if(!e||!t)return void console.log("[E-COMMERCE] Mobile toggle or menu not found");if(e.hasAttribute("data-ecommerce-init"))return;e.setAttribute("data-ecommerce-init","true"),console.log("[E-COMMERCE] Initializing mobile menu for e-commerce page"),e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();const o=this.querySelector(".hamburger-icon"),n=this.querySelector(".close-icon");t.classList.contains("active")?(t.classList.remove("active"),t.style.display="",o&&o.style.setProperty("display","block","important"),n&&n.style.setProperty("display","none","important"),document.body.style.overflow="",console.log("[E-COMMERCE] Menu closed")):(t.classList.add("active"),t.style.display="block",o&&o.style.setProperty("display","none","important"),n&&n.style.setProperty("display","block","important"),document.body.style.overflow="hidden",console.log("[E-COMMERCE] Menu opened"))});t.querySelectorAll("a").forEach(function(o){o.addEventListener("click",function(){const o=e.querySelector(".hamburger-icon"),n=e.querySelector(".close-icon");t.classList.remove("active"),t.style.display="",o&&o.style.setProperty("display","block","important"),n&&n.style.setProperty("display","none","important"),document.body.style.overflow=""})}),console.log("[E-COMMERCE] Mobile menu initialized successfully")}async function loadProductDetailPage(){const e=document.getElementById("product-detail");if(!e)return;const t=window.ZAPPY_WEBSITE_ID;if(!t)return;const o={products:"Products",ourProducts:"Our Products",featuredProducts:"Featured Products",noFeaturedProducts:"No featured products yet. Check out all our products!",featuredCategories:"Shop by Category",all:"All",featured:"Featured",new:"New",sale:"Sale",loadingProducts:"Loading products...",cart:"Cart",yourCart:"Your Cart",emptyCart:"Cart is empty",total:"Total",proceedToCheckout:"Proceed to Checkout",checkout:"Checkout",customerInfo:"Customer Info",fullName:"Full Name",email:"Email",phone:"Phone",shippingAddress:"Shipping Address",street:"Street Address",apartment:"Apt, Floor, Unit",city:"City",zip:"ZIP Code",shippingMethod:"Shipping Method",loadingShipping:"Loading shipping methods...",payment:"Payment",loadingPayment:"Loading payment options...",orderSummary:"Order Summary",subtotal:"Subtotal",vat:"VAT",vatIncluded:"VAT Included",shipping:"Shipping",discount:"Discount",totalToPay:"Total",placeOrder:"Place Order",login:"Login",customerLogin:"Customer Login",enterEmail:"Enter your email and we'll send you a login code",emailAddress:"Email Address",sendCode:"Send Code",enterCode:"Enter the code sent to your email",verificationCode:"Verification Code",verify:"Verify",returnPolicy:"Return Policy",addToCart:"Add to Cart",addedToCart:"Product added to cart!",remove:"Remove",noProducts:"No products to display",errorLoading:"Error loading",days:"days",currency:"$",free:"FREE",freeAbove:"Free above",noShippingMethods:"No shipping options available",viewAllResults:"View all results",searchProducts:"Search products",productDetails:"Product Details",viewDetails:"View Details",inStock:"In Stock",outOfStock:"Out of Stock",sku:"SKU",category:"Category",relatedProducts:"Related Products",productNotFound:"Product not found",backToProducts:"Back to Products",home:"Home",quantity:"Quantity",couponCode:"Coupon Code",enterCouponCode:"Enter coupon code",applyCoupon:"Apply",removeCoupon:"Remove",couponApplied:"Coupon applied successfully!",invalidCoupon:"Invalid coupon code",couponExpired:"Coupon has expired",couponMinOrder:"Minimum order amount",alreadyHaveAccount:"Already have an account?",loginHere:"Login here",loggedInAs:"Logged in as:",logout:"Logout",haveCouponCode:"I have a coupon code",orderSuccess:"Order Received!",thankYouOrder:"Thank you for your order",orderNumber:"Order Number",orderConfirmation:"A confirmation email has been sent to you",orderProcessing:"Your order is being processed. We'll notify you when it ships.",continueShopping:"Continue Shopping",orderDetails:"Order Details",loadingOrder:"Loading order details...",orderNotFound:"Order not found",orderItems:"Order Items",paidAmount:"Amount Paid",myAccount:"My Account",accountWelcome:"Welcome",yourOrders:"Your Orders",noOrders:"No orders yet",orderDate:"Date",orderStatus:"Status",orderTotal:"Total",viewOrder:"View Order",statusPending:"Pending Payment",statusPaid:"Paid",statusProcessing:"Processing",statusShipped:"Shipped",statusDelivered:"Delivered",statusCancelled:"Cancelled",notLoggedIn:"Not Logged In",pleaseLogin:"Please login to view your account",personalDetails:"Personal Details",editProfile:"Edit Profile",name:"Name",saveChanges:"Save Changes",cancel:"Cancel",addresses:"Addresses",addAddress:"Add Address",editAddress:"Edit Address",deleteAddress:"Delete Address",setAsDefault:"Set as Default",defaultAddress:"Default Address",addressLabel:"Address Label",work:"Work",other:"Other",noAddresses:"No saved addresses",confirmDelete:"Are you sure you want to delete?",profileUpdated:"Profile updated successfully",addressSaved:"Address saved successfully",addressDeleted:"Address deleted",saving:"Saving...",selectVariant:"Select option",variantUnavailable:"Unavailable",color:"Color",size:"Size",material:"Material",style:"Style",weight:"Weight",capacity:"Capacity",length:"Length",inquiryAbout:"Inquiry about",sendInquiry:"Send Inquiry",callNow:"Call Now",specifications:"Specifications",businessPhone:"[business_phone]",businessEmail:"[business_email]"};let n=window.location.pathname;const a=new URLSearchParams(window.location.search).get("page");a&&(n=a);const r=n.split("/"),i=r[r.length-1];if(i&&"product"!==i){console.log("Loading product with slug:",i);try{const n=await fetch(buildApiUrlWithLang("/api/ecommerce/storefront/products/"+encodeURIComponent(i)+"?websiteId="+t)),a=await n.json();if(!a.success||!a.data)return void showProductNotFound(e,o);const r=a.data;renderProductDetail(e,r,o),document.title=r.name+" - "+(document.title.split(" - ").pop()||""),loadRelatedProducts(r,o)}catch(t){console.error("Failed to load product",t),showProductNotFound(e,o)}}else showProductNotFound(e,o)}async function loadCategoryPage(){const e=document.getElementById("category-page");if(!e)return;const t=window.ZAPPY_WEBSITE_ID;if(!t)return;const o={products:"Products",ourProducts:"Our Products",featuredProducts:"Featured Products",noFeaturedProducts:"No featured products yet. Check out all our products!",featuredCategories:"Shop by Category",all:"All",featured:"Featured",new:"New",sale:"Sale",loadingProducts:"Loading products...",cart:"Cart",yourCart:"Your Cart",emptyCart:"Cart is empty",total:"Total",proceedToCheckout:"Proceed to Checkout",checkout:"Checkout",customerInfo:"Customer Info",fullName:"Full Name",email:"Email",phone:"Phone",shippingAddress:"Shipping Address",street:"Street Address",apartment:"Apt, Floor, Unit",city:"City",zip:"ZIP Code",shippingMethod:"Shipping Method",loadingShipping:"Loading shipping methods...",payment:"Payment",loadingPayment:"Loading payment options...",orderSummary:"Order Summary",subtotal:"Subtotal",vat:"VAT",vatIncluded:"VAT Included",shipping:"Shipping",discount:"Discount",totalToPay:"Total",placeOrder:"Place Order",login:"Login",customerLogin:"Customer Login",enterEmail:"Enter your email and we'll send you a login code",emailAddress:"Email Address",sendCode:"Send Code",enterCode:"Enter the code sent to your email",verificationCode:"Verification Code",verify:"Verify",returnPolicy:"Return Policy",addToCart:"Add to Cart",addedToCart:"Product added to cart!",remove:"Remove",noProducts:"No products to display",errorLoading:"Error loading",days:"days",currency:"$",free:"FREE",freeAbove:"Free above",noShippingMethods:"No shipping options available",viewAllResults:"View all results",searchProducts:"Search products",productDetails:"Product Details",viewDetails:"View Details",inStock:"In Stock",outOfStock:"Out of Stock",sku:"SKU",category:"Category",relatedProducts:"Related Products",productNotFound:"Product not found",backToProducts:"Back to Products",home:"Home",quantity:"Quantity",couponCode:"Coupon Code",enterCouponCode:"Enter coupon code",applyCoupon:"Apply",removeCoupon:"Remove",couponApplied:"Coupon applied successfully!",invalidCoupon:"Invalid coupon code",couponExpired:"Coupon has expired",couponMinOrder:"Minimum order amount",alreadyHaveAccount:"Already have an account?",loginHere:"Login here",loggedInAs:"Logged in as:",logout:"Logout",haveCouponCode:"I have a coupon code",orderSuccess:"Order Received!",thankYouOrder:"Thank you for your order",orderNumber:"Order Number",orderConfirmation:"A confirmation email has been sent to you",orderProcessing:"Your order is being processed. We'll notify you when it ships.",continueShopping:"Continue Shopping",orderDetails:"Order Details",loadingOrder:"Loading order details...",orderNotFound:"Order not found",orderItems:"Order Items",paidAmount:"Amount Paid",myAccount:"My Account",accountWelcome:"Welcome",yourOrders:"Your Orders",noOrders:"No orders yet",orderDate:"Date",orderStatus:"Status",orderTotal:"Total",viewOrder:"View Order",statusPending:"Pending Payment",statusPaid:"Paid",statusProcessing:"Processing",statusShipped:"Shipped",statusDelivered:"Delivered",statusCancelled:"Cancelled",notLoggedIn:"Not Logged In",pleaseLogin:"Please login to view your account",personalDetails:"Personal Details",editProfile:"Edit Profile",name:"Name",saveChanges:"Save Changes",cancel:"Cancel",addresses:"Addresses",addAddress:"Add Address",editAddress:"Edit Address",deleteAddress:"Delete Address",setAsDefault:"Set as Default",defaultAddress:"Default Address",addressLabel:"Address Label",work:"Work",other:"Other",noAddresses:"No saved addresses",confirmDelete:"Are you sure you want to delete?",profileUpdated:"Profile updated successfully",addressSaved:"Address saved successfully",addressDeleted:"Address deleted",saving:"Saving...",selectVariant:"Select option",variantUnavailable:"Unavailable",color:"Color",size:"Size",material:"Material",style:"Style",weight:"Weight",capacity:"Capacity",length:"Length",inquiryAbout:"Inquiry about",sendInquiry:"Send Inquiry",callNow:"Call Now",specifications:"Specifications",businessPhone:"[business_phone]",businessEmail:"[business_email]"};let n=window.location.pathname;const a=new URLSearchParams(window.location.search).get("page");a&&(n=a);const r=n.split("/"),i=r[r.length-1];if(i&&"category"!==i){console.log("Loading category with slug:",i);try{const n=await fetch(buildApiUrlWithLang("/api/ecommerce/storefront/categories/"+encodeURIComponent(i)+"?websiteId="+t)),a=await n.json();if(!a.success||!a.data)return void showCategoryNotFound(e,o);const r=a.data;renderCategoryPage(e,r,o),document.title=r.name+" - "+(document.title.split(" - ").pop()||"")}catch(t){console.error("Failed to load category",t),showCategoryNotFound(e,o)}}else showCategoryNotFound(e,o)}function showCategoryNotFound(e,t){e.innerHTML=`\n    <div class="category-not-found">\n      <h2>${t.categoryNotFound||"Category not found"}</h2>\n      <a href="/products" class="btn btn-primary">${t.backToProducts}</a>\n    </div>\n  `}function renderCategoryPage(e,t,o){const n=document.getElementById("category-header"),a=document.getElementById("zappy-category-products");if(n){const e=t.image?'<div class="category-banner" style="background-image: url(\''+resolveProductImageUrl(t.image)+"')\"></div>":"";n.innerHTML=e+'<div class="category-info"><h1>'+t.name+"</h1>"+(t.description?'<p class="category-description">'+t.description+"</p>":"")+"</div>"}const r=t.products||[];a&&(0===r.length?a.innerHTML='<div class="no-products">'+(o.noProducts||"No products in this category yet.")+"</div>":renderProductGrid(a,r,o,!1));const i=e.querySelectorAll(".filter-btn");i.forEach(function(e){e.addEventListener("click",function(){i.forEach(function(e){e.classList.remove("active")}),e.classList.add("active");const t=e.getAttribute("data-category");let n=r;"featured"===t?n=r.filter(function(e){return e.is_featured}):"new"===t?n=r.filter(function(e){return e.tags&&e.tags.some(function(e){return"new"===e.toLowerCase()||"×—×“×©"===e.toLowerCase()})}):"sale"===t&&(n=r.filter(function(e){return e.sale_price&&parseFloat(e.sale_price)<parseFloat(e.price)||e.tags&&e.tags.some(function(e){return"sale"===e.toLowerCase()||"××‘×¦×¢"===e.toLowerCase()})})),a&&(0===n.length?a.innerHTML='<div class="no-products">'+(o.noProducts||"No products found.")+"</div>":renderProductGrid(a,n,o,!1))})})}function showProductNotFound(e,t){e.innerHTML=`\n    <div class="product-not-found">\n      <h2>${t.productNotFound}</h2>\n      <a href="/products" class="btn btn-primary">${t.backToProducts}</a>\n    </div>\n  `}function renderProductDetail(e,t,o){const n=(t.images||[]).map(function(e){return window.resolveProductImageUrl?window.resolveProductImageUrl(e):e}).filter(Boolean),a=n[0]||"",r=n.length>1,i="out_of_stock"!==t.stock_status,s=t.sale_price&&parseFloat(t.sale_price)<parseFloat(t.price),d=s?parseFloat(t.sale_price):parseFloat(t.price),c=parseFloat(t.price),l=!1!==t.custom_fields?.showPrice,u=t.variants||[],p=u.length>0;let m="";if(p){const e={};u.forEach(t=>{t.attributes&&!1!==t.is_active&&Object.entries(t.attributes).forEach(([t,o])=>{e[t]||(e[t]=new Set),e[t].add(o)})});const t={color:o.color||"Color",size:o.size||"Size",material:o.material||"Material",style:o.style||"Style",weight:o.weight||"Weight",capacity:o.capacity||"Capacity",length:o.length||"Length"};m='<div class="product-variants" id="product-variants">'+Object.entries(e).map(([e,o])=>{const n=t[e.toLowerCase()]||e.charAt(0).toUpperCase()+e.slice(1),a=Array.from(o),r="color"===e.toLowerCase(),i=a.map(t=>{if(r){var o=t;return/^#[0-9A-Fa-f]{3,6}$/.test(t)||(o=t.toLowerCase()),'<button type="button" class="variant-option color-swatch" data-attr="'+e+'" data-value="'+t+'" style="background-color: '+o+';" title="'+t+'"></button>'}return'<button type="button" class="variant-option" data-attr="'+e+'" data-value="'+t+'">'+t+"</button>"}).join("");return'<div class="variant-group" data-group="'+e+'"><label class="variant-group-label">'+n+':</label><div class="variant-options">'+i+"</div></div>"}).join("")+"</div>"}var g='<nav class="product-breadcrumb">';g+='<a href="/">'+o.home+"</a>",g+='<span class="breadcrumb-separator">â€º</span>',g+='<a href="/products">'+o.products+"</a>",t.category_name&&(g+='<span class="breadcrumb-separator">â€º</span>',t.category_id?g+='<a href="/products?category='+t.category_id+'">'+t.category_name+"</a>":g+='<span class="breadcrumb-current">'+t.category_name+"</span>"),g+='<span class="breadcrumb-separator">â€º</span>',g+='<span class="breadcrumb-current">'+t.name+"</span>",g+="</nav>",e.innerHTML=`\n    ${g}\n    <div class="product-detail-container">\n      <div class="product-gallery">\n        ${a?'<img src="'+a+'" alt="'+t.name+'" class="product-gallery-main" id="product-main-image">':'<div class="product-gallery-main" style="display:flex;align-items:center;justify-content:center;color:#999;font-size:64px;">ğŸ“¦</div>'}\n        ${r?`\n          <div class="product-gallery-thumbs">\n            ${n.map((e,o)=>`\n              <img src="${e}" alt="${t.name}" class="product-gallery-thumb ${0===o?"active":""}" onclick="changeMainImage(this, '${e}')" />\n            `).join("")}\n          </div>\n        `:""}\n      </div>\n      <div class="product-info">\n        <h1>${t.name}</h1>\n        ${l?`\n        <div class="product-price" id="product-price-display">\n          ${s?o.currency+t.sale_price+'<span class="original-price">'+o.currency+t.price+"</span>":o.currency+t.price}\n        </div>\n        `:""}\n        ${t.sku?'<div class="product-sku" id="product-sku-display">'+o.sku+": "+t.sku+"</div>":""}\n        <div class="product-stock ${i?"in-stock":"out-of-stock"}" id="product-stock-display">\n          ${i?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>'+o.inStock:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>'+o.outOfStock}\n        </div>\n        ${t.description?'<div class="product-description">'+t.description+"</div>":""}\n        ${t.custom_fields?.specifications?.length>0?`\n        <div class="product-specifications">\n          <h3>${o.specifications}</h3>\n          <table class="specs-table">\n            ${t.custom_fields.specifications.map(e=>`\n              <tr>\n                <th>${e.key}</th>\n                <td>${e.value}</td>\n              </tr>\n            `).join("")}\n          </table>\n        </div>\n        `:""}\n        ${m}\n        \n        <div class="product-quantity">\n          <label>${o.quantity}:</label>\n          <div class="quantity-selector">\n            <button type="button" onclick="adjustQuantity(-1)">âˆ’</button>\n            <input type="number" id="product-quantity" value="1" min="1" max="99">\n            <button type="button" onclick="adjustQuantity(1)">+</button>\n          </div>\n        </div>\n        \n        <div class="product-actions ">\n          \n          <button class="add-to-cart" id="add-to-cart-btn" onclick="addProductToCart()" ${i?"":'disabled style="opacity:0.5;cursor:not-allowed;"'}>\n            ${o.addToCart}\n          </button>\n          \n        </div>\n      </div>\n    </div>\n  `,window.currentProduct=t,window.selectedVariant=null,window.productBasePrice=d,window.productOriginalPrice=c,window.productHasSalePrice=s,window.productTranslations=o,p&&initVariantSelection(t,o)}function changeMainImage(e,t){const o=document.getElementById("product-main-image");o&&(o.src=t),document.querySelectorAll(".product-gallery-thumb").forEach(e=>e.classList.remove("active")),e.classList.add("active")}function adjustQuantity(e){const t=document.getElementById("product-quantity");if(!t)return;const o=Math.max(1,Math.min(99,parseInt(t.value||1)+e));t.value=o}function initVariantSelection(e,t){const o=e.variants||[];let n={};const a=document.querySelectorAll(".variant-option");function r(e){if(!e||!n[e])return void a.forEach(e=>{e.classList.remove("disabled"),e.disabled=!1});const t=n[e];a.forEach(n=>{const a=n.getAttribute("data-attr"),r=n.getAttribute("data-value");if(a===e)return n.classList.remove("disabled"),void(n.disabled=!1);const i=function(e,t,n,a){return o.some(o=>!(!o.attributes||!1===o.is_active)&&o.attributes[e]===t&&o.attributes[n]===a)}(a,r,e,t);i?(n.classList.remove("disabled"),n.disabled=!1):(n.classList.add("disabled"),n.disabled=!0)})}a.forEach(i=>{i.addEventListener("click",function(){const i=this.getAttribute("data-attr"),s=this.getAttribute("data-value");if(this.disabled||this.classList.contains("disabled")){const e=function(){const e=new Set;return a.forEach(t=>e.add(t.getAttribute("data-attr"))),Array.from(e)}();e.forEach(e=>{e!==i&&(delete n[e],document.querySelectorAll('.variant-option[data-attr="'+e+'"]').forEach(e=>{e.classList.remove("selected")}))})}document.querySelectorAll('.variant-option[data-attr="'+i+'"]').forEach(e=>e.classList.remove("selected")),this.classList.add("selected"),n[i]=s,r(i);updateVariantUI(findMatchingVariant(o,n),e,t,n)})})}function findMatchingVariant(e,t){const o=Object.keys(t);return 0===o.length?null:e.find(e=>!(!e.attributes||!1===e.is_active)&&o.every(o=>e.attributes[o]===t[o]))}function updateVariantUI(e,t,o,n){const a=document.getElementById("product-price-display"),r=document.getElementById("product-stock-display"),i=document.getElementById("product-sku-display"),s=document.getElementById("add-to-cart-btn"),d=window.productBasePrice,c=window.productOriginalPrice,l=window.productHasSalePrice;if(e){const t=e.price?parseFloat(e.price):null,n=null!==t?t:d;a&&(null!==t?a.textContent=o.currency+n.toFixed(2):l?a.innerHTML=o.currency+n.toFixed(2)+'<span class="original-price">'+o.currency+c.toFixed(2)+"</span>":a.textContent=o.currency+n.toFixed(2));const u="out_of_stock"!==e.stock_status;r&&(r.className="product-stock "+(u?"in-stock":"out-of-stock"),r.innerHTML=u?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>'+o.inStock:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>'+o.outOfStock),i&&e.sku&&(i.textContent=o.sku+": "+e.sku),s&&(s.disabled=!u,s.style.opacity=u?"1":"0.5",s.style.cursor=u?"pointer":"not-allowed"),window.selectedVariant=e}else{a&&(l?a.innerHTML=o.currency+d.toFixed(2)+'<span class="original-price">'+o.currency+c.toFixed(2)+"</span>":a.textContent=o.currency+d.toFixed(2));const e="out_of_stock"!==t.stock_status;r&&(r.className="product-stock "+(e?"in-stock":"out-of-stock"),r.innerHTML=e?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>'+o.inStock:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>'+o.outOfStock),s&&(s.disabled=!e,s.style.opacity=e?"1":"0.5",s.style.cursor=e?"pointer":"not-allowed"),window.selectedVariant=null}}function addProductToCart(){const e=window.currentProduct;if(!e)return;const t=parseInt(document.getElementById("product-quantity")?.value||1),o=window.selectedVariant,n={...e,quantity:t};if(o){const e=window.productBasePrice,t=o.price?parseFloat(o.price):null,a=null!==t?t:e;n.selectedVariant={id:o.id,name:o.name,sku:o.sku,attributes:o.attributes,price:t},n.variantName=o.name,n.displayPrice=a,n.price=a.toString(),n.sale_price=null,o.sku&&(n.variantSku=o.sku)}for(let e=0;e<t;e++)window.zappyAddToCart(n)}async function loadRelatedProducts(e,t){const o=document.getElementById("related-products-section"),n=document.getElementById("related-products-grid");if(!o||!n)return;const a=window.ZAPPY_WEBSITE_ID;try{let r=buildApiUrlWithLang("/api/ecommerce/storefront/products?websiteId="+a+"&limit=4");e.category_id&&(r+="&categoryId="+e.category_id);const i=await fetch(r),s=await i.json();if(!s.success||!s.data?.length)return;const d=s.data.filter(t=>t.id!==e.id).slice(0,4);if(0===d.length)return;renderProductGrid(n,d,t),o.style.display="block"}catch(e){console.error("Failed to load related products",e)}}function hasConsentFor(e){return void 0!==window.CookieConsent&&window.CookieConsent.validConsent(e)}function withConsent(e,t){hasConsentFor(e)?t():console.log(`[WARNING] Skipping ${e} code - no user consent`)}document.addEventListener("DOMContentLoaded",function(){initEcommerceMobileMenu(),fetchAdditionalJsSettings(),loadFeaturedProducts(),loadFeaturedCategories(),loadCatalogCategories(),loadProductDetailPage(),loadCategoryPage(),"undefined"!=typeof zappyI18n&&"function"==typeof zappyI18n.onLanguageChange&&(zappyI18n.onLanguageChange(function(e,t){console.log("[E-COMMERCE] Language changed from "+t+" to "+e+", refreshing content..."),fetchAdditionalJsSettings(!0),loadFeaturedProducts(),loadFeaturedCategories(),loadCatalogCategories(),document.getElementById("product-detail")&&loadProductDetailPage(),document.getElementById("category-products")&&loadCategoryPage(),document.getElementById("zappy-product-grid")&&"function"==typeof loadProducts&&loadProducts(),function(){var e=document.getElementById("add-to-cart-btn");e&&(e.textContent=getEcomText("addToCart","Add to Cart"));document.querySelectorAll("button.add-to-cart:not(#add-to-cart-btn)").forEach(function(e){e.textContent=getEcomText("addToCart","Add to Cart")}),document.querySelectorAll(".filter-btn").forEach(function(e){var t=e.getAttribute("data-category");"all"===t?e.textContent=getEcomText("all","All"):"featured"===t?e.textContent=getEcomText("featured","Featured"):"new"===t?e.textContent=getEcomText("new","New"):"sale"===t&&(e.textContent=getEcomText("sale","Sale"))});var t=document.querySelector(".empty-cart p");t&&(t.textContent=getEcomText("emptyCart","Your cart is empty"));var o=document.querySelector(".checkout-btn, #checkout-btn");o&&(o.textContent=getEcomText("proceedToCheckout","Proceed to Checkout"));console.log("[E-COMMERCE] Static UI elements updated for language change")}()}),console.log("[E-COMMERCE] Registered language change callback for content refresh"))}),function(){"use strict";let e=0;function t(){if(e++,void 0===window.CookieConsent)return void(e<50&&setTimeout(t,100));const o=window.CookieConsent;try{o.run({autoShow:!0,mode:"opt-in",revision:0,categories:{necessary:{enabled:!0,readOnly:!0},analytics:{enabled:!1,readOnly:!1,autoClear:{cookies:[{name:"_ga"},{name:"_ga_*"},{name:"_gid"},{name:"_gat"}]}},marketing:{enabled:!1,readOnly:!1,autoClear:{cookies:[{name:"_fbp"},{name:"_fbc"},{name:"fr"}]}}},language:{default:"en",translations:{en:{consentModal:{title:"We use cookies ğŸª",description:"King of Spreads uses cookies to enhance your experience, analyze site usage, and assist in our marketing efforts. You can manage your preferences anytime.",acceptAllBtn:"Accept All",acceptNecessaryBtn:"Accept Necessary",showPreferencesBtn:"Manage Preferences",footer:'<a href="#privacy-policy">Privacy Policy</a> | <a href="#terms-conditions">Terms & Conditions</a>'},preferencesModal:{title:"Cookie Preferences",acceptAllBtn:"Accept All",acceptNecessaryBtn:"Accept Necessary",savePreferencesBtn:"Save Preferences",closeIconLabel:"Close",sections:[{title:"Essential Cookies",description:"These cookies are necessary for the website to function and cannot be disabled.",linkedCategory:"necessary"},{title:"Analytics Cookies",description:"These cookies help us understand how visitors interact with our website.",linkedCategory:"analytics"},{title:"Marketing Cookies",description:"These cookies are used to deliver personalized advertisements.",linkedCategory:"marketing"}]}}}},guiOptions:{consentModal:{layout:"box",position:"bottom right",equalWeightButtons:!0,flipButtons:!1},preferencesModal:{layout:"box",equalWeightButtons:!0,flipButtons:!1}}}),"function"==typeof o.onChange&&o.onChange(function(e,t){t.includes("analytics")&&o.validConsent("analytics"),t.includes("marketing")&&o.validConsent("marketing")})}catch(e){}}"loading"===document.readyState?(document.addEventListener("DOMContentLoaded",t),setTimeout(t,1e3)):"interactive"===document.readyState||"complete"===document.readyState?t():setTimeout(t,500),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener("load",t,{once:!0})}(),window.onload=function(){try{window.micAccessTool=new MicAccessTool({buttonPosition:"left",forceLang:"en-US",icon:{position:{bottom:{size:50,units:"px"},left:{size:20,units:"px"},type:"fixed"},backgroundColor:"transparent",color:"transparent",img:"accessible",circular:!1},menu:{dimensions:{width:{size:300,units:"px"},height:{size:"auto",units:"px"}}}})}catch(e){}document.addEventListener("keydown",function(e){var t=e.altKey,o="KeyA"===e.code||65===e.keyCode||65===e.which||e.key&&("a"===e.key.toLowerCase()||"Ã¥"===e.key||"Ã…"===e.key);t&&o&&(window.innerWidth>768&&(e.preventDefault(),e.stopPropagation(),document.body.classList.contains("accessibility-widget-visible")?document.body.classList.remove("accessibility-widget-visible"):(document.body.classList.add("accessibility-widget-visible"),setTimeout(function(){var e=document.getElementById("mic-access-tool-general-button");e&&e.click()},200))))},!0)},function(){function e(){console.log("ğŸ“§ Zappy: Initializing contact form API integration...");const e=document.querySelector(".contact-form")||document.querySelector('form[action*="contact"]')||document.querySelector("form#contact")||document.querySelector("form#contactForm")||document.getElementById("contactForm")||document.querySelector("section.contact form")||document.querySelector("section#contact form")||document.querySelector("form");if(!e)return void console.log("âš ï¸ Zappy: No contact form found on page");console.log("âœ… Zappy: Contact form found:",e.className||e.id||"unnamed form");e.onsubmit;e.addEventListener("submit",async function(e){const t=new FormData(this),o=Object.fromEntries(t);try{console.log("ğŸ“§ Zappy: Sending contact form to backend API...");const e=await fetch("https://api.zappy5.com/api/email/contact-form",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteId:"57d753e3-506f-4785-abc6-bc36163da32a",name:o.name||"",email:o.email||"",subject:o.subject||"Contact Form Submission",message:o.message||"",phone:o.phone||null})}),t=await e.json();t.success?console.log("âœ… Zappy: Contact form data sent successfully to backend"):console.log("âš ï¸ Zappy: Backend returned error:",t.error)}catch(e){console.error("âŒ Zappy: Failed to send to backend API:",e)}},!0),console.log("âœ… Zappy: Contact form API integration initialized")}window.zappyContactFormLoaded?console.log("ğŸ“§ Zappy contact form already loaded"):(window.zappyContactFormLoaded=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e())}(),function(){try{if(window.__zappyPublishedLightboxInit)return;function e(e){try{return String(e||"").replace(/"/g,"&quot;")}catch(e){return""}}function t(t){try{if(!t||!t.id)return;if(0!==t.id.indexOf("zappy-lightbox-toggle-"))return;var o=t.id.replace("zappy-lightbox-toggle-",""),n=document.querySelector('label.zappy-lightbox-trigger[for="'+t.id+'"]');if(!n)return;try{n.contains(t)&&n.parentNode&&n.parentNode.insertBefore(t,n)}catch(d){}var a="zappy-lightbox-"+o,r=document.getElementById(a);if(r&&r.parentNode!==document.body)try{document.body.appendChild(r)}catch(c){}if(!r){var i=null;try{i=n.querySelector("img")}catch(l){}if(!i)try{i=document.querySelector('img[data-element-id="'+o+'"]')}catch(u){}if(!i)return;(r=document.createElement("div")).id=a,r.className="zappy-lightbox",r.setAttribute("data-zappy-image-lightbox","true"),r.style.display="none",r.innerHTML='<label class="zappy-lightbox-backdrop" for="'+t.id+'" aria-label="Close"></label><div class="zappy-lightbox-content"><label class="zappy-lightbox-close" for="'+t.id+'" aria-label="Close">Ã—</label><img class="zappy-lightbox-image" src="'+e(i.currentSrc||i.src||i.getAttribute("src"))+'" alt="'+e(i.getAttribute("alt")||"Image")+'"></div>',document.body.appendChild(r)}function s(){try{var e=n.querySelector("img"),t=r.querySelector("img");e&&t&&(t.src=e.currentSrc||e.src||t.src,t.alt=e.alt||t.alt)}catch(e){}}t.__zappyLbBound||(t.addEventListener("change",function(){t.checked&&s(),r.style.display=t.checked?"flex":"none"}),t.__zappyLbBound=!0),r.__zappyLbBound||(r.addEventListener("click",function(e){try{var o=e.target;if(!o)return;o.classList&&(o.classList.contains("zappy-lightbox-backdrop")||o.classList.contains("zappy-lightbox-close"))&&(e.preventDefault(),t.checked=!1,r.style.display="none")}catch(e){}}),r.__zappyLbBound=!0),n.__zappyLbClick||(n.addEventListener("click",function(e){try{if(document.body&&document.body.classList&&document.body.classList.contains("zappy-edit-mode"))return;if(e&&e.target&&e.target.closest&&e.target.closest("a[href],button,input,select,textarea"))return;e.preventDefault(),e.stopPropagation(),t.checked=!0,s(),r.style.display="flex"}catch(e){}},!0),n.__zappyLbClick=!0)}catch(p){}}function o(){try{for(var e=document.querySelectorAll('label.zappy-lightbox-trigger[for^="zappy-lightbox-toggle-"]'),o=0;o<e.length;o++){var n=e[o],a=n&&n.getAttribute?n.getAttribute("for"):null;if(a&&!document.getElementById(a)){var r=document.createElement("input");r.type="checkbox",r.id=a,r.className="zappy-lightbox-toggle",r.setAttribute("data-zappy-image-lightbox","true"),n.parentNode&&n.parentNode.insertBefore(r,n)}}for(var i=document.querySelectorAll('input.zappy-lightbox-toggle[id^="zappy-lightbox-toggle-"]'),s=0;s<i.length;s++)t(i[s]);document.__zappyLbEscBound||(document.addEventListener("keydown",function(e){try{if(!e||"Escape"!==e.key)return;var t=document.querySelector('.zappy-lightbox[style*="display: flex"]');if(t){var o=null;try{var n=t.id||"";0===n.indexOf("zappy-lightbox-")&&(o=document.getElementById("zappy-lightbox-toggle-"+n.replace("zappy-lightbox-","")))}catch(e){}o&&(o.checked=!1),t.style.display="none"}}catch(e){}}),document.__zappyLbEscBound=!0)}catch(e){}}window.__zappyPublishedLightboxInit=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o,{once:!0}):o()}catch(n){}}();